2025-07-30 17:29:24,019 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753867764019]
2025-07-30 17:29:24,144 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:29:24,148 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753867764_19230bb4, 用户: basic_intent_user_001
2025-07-30 17:29:24,169 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_001
2025-07-30 17:29:24,176 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_f9bee3bc4593 for user: basic_intent_user_001
2025-07-30 17:29:24,226 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_001, 项目数: 12
2025-07-30 17:29:24,232 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_001, 项目数: 12
2025-07-30 17:29:24,232 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_f9bee3bc4593
2025-07-30 17:29:24,252 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:29:24,253 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:29:30,560 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:557 - 规则匹配 - 意图 book_flight 得分: 14.900, 匹配关键词: ['direct_core_match:机票', 'partial_in_example:帮我预订机票', 'direct_core_match:机票', 'direct_core_match:机票', 'partial_in_example:我想订机票', 'direct_core_match:机票', 'direct_core_match:机票', 'partial_in_example:我要去北京，帮我订机票', 'direct_core_match:机票', 'direct_core_match:机票']
2025-07-30 17:29:30,561 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:572 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 14.900
2025-07-30 17:29:30,566 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:267 - 意图识别完成: 订机票 -> Intent(book_generic: 通用订票) (0.852)
2025-07-30 17:29:30,582 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.852 通过 intent-specific (book_generic)阈值 0.300 (等级: high)
2025-07-30 17:29:30,605 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.827, 主要类型=semantic, 信号数=13
2025-07-30 17:29:30,607 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.827, 主要类型=semantic, 候选数=1
2025-07-30 17:29:30,684 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订机票 -> book_generic
2025-07-30 17:29:30,689 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订机票 -> book_generic (置信度: 0.852)
2025-07-30 17:29:30,690 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订机票'
2025-07-30 17:29:30,691 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:29:30,720 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.5 INSERT by slot_service
2025-07-30 17:29:30,976 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6956ms [req_id=req_1753867764019]
2025-07-30 17:29:30,977 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6956ms
2025-07-30 17:29:30,979 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订机票', intent='book_generic', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 17:29:30,989 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 1
2025-07-30 17:29:46,705 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753867786705]
2025-07-30 17:29:46,711 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753867786_b8d07ddb, 用户: basic_intent_user_002
2025-07-30 17:29:46,723 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_002
2025-07-30 17:29:46,760 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_d4873ef2c54c for user: basic_intent_user_002
2025-07-30 17:29:46,802 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_002, 项目数: 12
2025-07-30 17:29:46,862 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_002, 项目数: 12
2025-07-30 17:29:46,863 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_d4873ef2c54c
2025-07-30 17:29:46,879 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:29:46,880 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:29:52,632 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:267 - 意图识别完成: 查余额 -> Intent(book_flight: 订机票) (0.852)
2025-07-30 17:29:52,646 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.852 通过 intent-specific (book_flight)阈值 0.400 (等级: high)
2025-07-30 17:29:52,665 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.827, 主要类型=semantic, 信号数=15
2025-07-30 17:29:52,666 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.827, 主要类型=semantic, 候选数=1
2025-07-30 17:29:52,716 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查余额 -> book_flight
2025-07-30 17:29:52,809 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查余额 -> book_flight (置信度: 0.852)
2025-07-30 17:29:52,810 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查余额'
2025-07-30 17:29:52,811 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:29:52,879 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.1 INSERT by slot_service
2025-07-30 17:29:52,904 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-30 17:29:52,942 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_002, 继承槽位=0, 应用规则=0
2025-07-30 17:29:53,273 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:643 - 实体提取完成: '查余额...' -> 0 个实体
2025-07-30 17:29:53,492 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1375 - LLM槽位提取结果: {}
2025-07-30 17:29:53,495 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 17:29:53,602 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6897ms [req_id=req_1753867786705]
2025-07-30 17:29:53,603 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6897ms
2025-07-30 17:29:53,605 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查余额', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 17:29:53,613 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 2
2025-07-30 17:32:22,523 - src.main - [32mINFO[0m - main.py:72 - 正在关闭系统...
2025-07-30 17:32:22,539 - src.services.cache_service - [32mINFO[0m - cache_service.py:87 - Redis连接已关闭
2025-07-30 17:32:22,540 - src.main - [32mINFO[0m - main.py:88 - 系统关闭完成
2025-07-30 17:32:28,891 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 17:32:28,900 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 17:32:29,052 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 17:32:29,079 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:32:29,080 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 17:32:29,081 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 17:32:29,082 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 17:32:29,147 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-30 17:32:29,164 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 17:32:29,173 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 17:32:29,174 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 17:32:29,175 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 17:32:29,176 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 17:32:29,177 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 17:32:29,178 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 17:32:29,179 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 17:32:29,184 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:118 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 17:32:29,486 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:174 - ✅ LLM连接测试成功
2025-07-30 17:32:29,491 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:158 - 加载了7个意图到缓存
2025-07-30 17:32:29,492 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:134 - NLU引擎初始化完成
2025-07-30 17:32:29,500 - src.main - [32mINFO[0m - main.py:207 - 预热了 7 个活跃意图配置
2025-07-30 17:32:29,507 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-30 17:32:29,508 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 17:32:29,508 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 17:32:29,508 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 17:32:29,509 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 17:37:54,257 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 17:37:54,262 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 17:37:54,332 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 17:37:54,379 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:37:54,379 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 17:37:54,379 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 17:37:54,379 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 17:37:54,398 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-30 17:37:54,402 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 17:37:54,403 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 17:37:54,404 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 17:37:54,404 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 17:37:54,404 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 17:37:54,404 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 17:37:54,404 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 17:37:54,404 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 17:37:54,405 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:118 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 17:37:54,702 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:237 - ✅ LLM连接测试成功
2025-07-30 17:37:54,705 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:158 - 加载了7个意图到缓存
2025-07-30 17:37:54,706 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:134 - NLU引擎初始化完成
2025-07-30 17:37:54,775 - src.main - [32mINFO[0m - main.py:207 - 预热了 7 个活跃意图配置
2025-07-30 17:37:54,781 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-30 17:37:54,781 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 17:37:54,781 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 17:37:54,782 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 17:37:54,782 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 17:38:08,367 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868288367]
2025-07-30 17:38:08,431 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:38:08,433 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868288_2e7d1364, 用户: test_user_001
2025-07-30 17:38:08,443 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_user_001
2025-07-30 17:38:08,449 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_5d4f28b481bb for user: test_user_001
2025-07-30 17:38:08,479 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_user_001, 项目数: 12
2025-07-30 17:38:08,482 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_user_001, 项目数: 12
2025-07-30 17:38:08,482 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_5d4f28b481bb
2025-07-30 17:38:08,489 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:38:08,489 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:38:14,699 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,702 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,704 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,706 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,708 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,710 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,712 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,714 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,717 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,718 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,721 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,724 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,726 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,729 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,731 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,734 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,736 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,738 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,741 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,743 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,746 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,748 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,750 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,752 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,755 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,757 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,759 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,761 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,763 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,765 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,767 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,769 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,771 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,773 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,775 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,777 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,779 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,781 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,783 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,785 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,785 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:621 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 17:38:14,787 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,789 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,791 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,792 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,795 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,797 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,799 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,801 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,803 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,805 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,808 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,810 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,813 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,816 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,818 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,821 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,824 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,826 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,829 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,832 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,835 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,837 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,840 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,842 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,845 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,847 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,849 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:14,849 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:636 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 17:38:14,850 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:330 - 意图识别完成: 查余额 -> Intent(book_flight: 订机票) (0.852)
2025-07-30 17:38:14,856 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.852 通过 intent-specific (book_flight)阈值 0.400 (等级: high)
2025-07-30 17:38:14,861 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.827, 主要类型=semantic, 信号数=15
2025-07-30 17:38:14,861 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.827, 主要类型=semantic, 候选数=1
2025-07-30 17:38:14,946 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查余额 -> book_flight
2025-07-30 17:38:14,950 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查余额 -> book_flight (置信度: 0.852)
2025-07-30 17:38:14,951 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查余额'
2025-07-30 17:38:14,951 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:38:14,971 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-30 17:38:15,052 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_user_001, 继承槽位=0, 应用规则=0
2025-07-30 17:38:15,288 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:707 - 实体提取完成: '查余额...' -> 0 个实体
2025-07-30 17:38:15,504 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1439 - LLM槽位提取结果: {}
2025-07-30 17:38:15,505 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 17:38:15,575 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7207ms [req_id=req_1753868288367]
2025-07-30 17:38:15,575 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7207ms
2025-07-30 17:38:15,576 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查余额', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 17:38:15,582 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 3
2025-07-30 17:38:18,857 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868298857]
2025-07-30 17:38:18,859 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868298_b3779c4c, 用户: test_user_002
2025-07-30 17:38:18,865 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_user_002
2025-07-30 17:38:18,944 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_4011db4c23a0 for user: test_user_002
2025-07-30 17:38:18,966 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_user_002, 项目数: 12
2025-07-30 17:38:18,969 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_user_002, 项目数: 12
2025-07-30 17:38:18,969 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_4011db4c23a0
2025-07-30 17:38:18,979 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:38:18,980 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:38:24,805 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,808 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,811 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,813 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,816 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,818 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,820 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,822 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,824 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,827 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,829 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,831 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,833 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,836 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,838 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,841 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,843 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,845 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,847 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,849 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,851 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,853 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,855 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,856 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,858 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,860 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,862 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,862 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:621 - 规则匹配 - 意图 book_flight 得分: 42.900, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:帮我预订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我想订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我要去北京，帮我订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:38:24,864 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,866 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,869 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,871 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,873 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,875 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,877 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,880 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,882 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,885 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,887 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,889 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,890 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,892 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,894 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,896 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,898 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,899 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,901 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,903 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,903 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:621 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:38:24,905 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,906 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,908 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,910 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,911 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,913 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,914 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,916 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,918 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,919 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,920 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:621 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:38:24,921 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,923 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,924 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,926 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,928 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,929 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,931 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:199 - 从数据库加载了17个关键词映射
2025-07-30 17:38:24,931 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:621 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:38:24,931 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:636 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 42.900
2025-07-30 17:38:24,932 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:330 - 意图识别完成: 订机票 -> Intent(check_balance: 查询账户余额) (0.852)
2025-07-30 17:38:24,937 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.852 通过 intent-specific (check_balance)阈值 0.700 (等级: high)
2025-07-30 17:38:24,942 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.777, 主要类型=semantic, 信号数=7
2025-07-30 17:38:24,942 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.777, 主要类型=semantic, 候选数=1
2025-07-30 17:38:24,981 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订机票 -> check_balance
2025-07-30 17:38:24,984 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订机票 -> check_balance (置信度: 0.852)
2025-07-30 17:38:24,984 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订机票'
2025-07-30 17:38:24,985 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:38:24,995 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.2 INSERT by slot_service
2025-07-30 17:38:25,187 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=2, 节点数=1, 边数=0
2025-07-30 17:38:25,205 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_user_002, 继承槽位=0, 应用规则=0
2025-07-30 17:38:25,375 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:707 - 实体提取完成: '订机票...' -> 0 个实体
2025-07-30 17:38:25,564 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1439 - LLM槽位提取结果: {}
2025-07-30 17:38:25,564 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-30 17:38:25,608 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-30 17:38:25,758 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6900ms [req_id=req_1753868298857]
2025-07-30 17:38:25,758 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6900ms
2025-07-30 17:38:25,759 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订机票', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 17:38:25,768 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-30 17:38:25,775 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=4, 成功=1/1
2025-07-30 17:38:25,776 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 4
2025-07-30 17:38:47,143 - src.main - [32mINFO[0m - main.py:72 - 正在关闭系统...
2025-07-30 17:38:47,144 - src.services.cache_service - [32mINFO[0m - cache_service.py:87 - Redis连接已关闭
2025-07-30 17:38:47,144 - src.main - [32mINFO[0m - main.py:88 - 系统关闭完成
2025-07-30 17:38:49,778 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 17:38:49,781 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 17:38:49,837 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 17:38:49,876 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:38:49,877 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 17:38:49,877 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 17:38:49,877 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 17:38:49,913 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-30 17:38:49,920 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 17:38:49,924 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 17:38:49,924 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 17:38:49,925 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 17:38:49,925 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 17:38:49,926 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 17:38:49,926 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 17:38:49,926 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 17:38:49,926 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 17:38:50,244 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:238 - ✅ LLM连接测试成功
2025-07-30 17:38:50,249 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:159 - 加载了7个意图到缓存
2025-07-30 17:38:50,249 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:135 - NLU引擎初始化完成
2025-07-30 17:38:50,275 - src.main - [32mINFO[0m - main.py:207 - 预热了 7 个活跃意图配置
2025-07-30 17:38:50,284 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-30 17:38:50,285 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 17:38:50,285 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 17:38:50,285 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 17:38:50,286 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 17:38:52,504 - src.main - [32mINFO[0m - main.py:72 - 正在关闭系统...
2025-07-30 17:38:52,505 - src.services.cache_service - [32mINFO[0m - cache_service.py:87 - Redis连接已关闭
2025-07-30 17:38:52,505 - src.main - [32mINFO[0m - main.py:88 - 系统关闭完成
2025-07-30 17:38:54,977 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 17:38:54,981 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 17:38:55,018 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 17:38:55,105 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:38:55,106 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 17:38:55,106 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 17:38:55,106 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 17:38:55,121 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-30 17:38:55,124 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 17:38:55,126 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 17:38:55,126 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 17:38:55,126 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 17:38:55,126 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 17:38:55,127 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 17:38:55,127 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 17:38:55,127 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 17:38:55,127 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 17:38:55,400 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:241 - ✅ LLM连接测试成功
2025-07-30 17:38:55,406 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了7个意图到缓存
2025-07-30 17:38:55,426 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-30 17:38:55,427 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-30 17:38:55,499 - src.main - [32mINFO[0m - main.py:207 - 预热了 7 个活跃意图配置
2025-07-30 17:38:55,509 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-30 17:38:55,509 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 17:38:55,510 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 17:38:55,510 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 17:38:55,510 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 17:39:01,769 - src.main - [32mINFO[0m - main.py:72 - 正在关闭系统...
2025-07-30 17:39:01,770 - src.services.cache_service - [32mINFO[0m - cache_service.py:87 - Redis连接已关闭
2025-07-30 17:39:01,770 - src.main - [32mINFO[0m - main.py:88 - 系统关闭完成
2025-07-30 17:39:03,959 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 17:39:03,963 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 17:39:04,010 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 17:39:04,109 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:39:04,110 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 17:39:04,110 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 17:39:04,111 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 17:39:04,140 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-30 17:39:04,144 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 17:39:04,147 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 17:39:04,147 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 17:39:04,147 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 17:39:04,147 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 17:39:04,147 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 17:39:04,148 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 17:39:04,148 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 17:39:04,148 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 17:39:04,433 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:241 - ✅ LLM连接测试成功
2025-07-30 17:39:04,438 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了7个意图到缓存
2025-07-30 17:39:04,457 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-30 17:39:04,458 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-30 17:39:04,509 - src.main - [32mINFO[0m - main.py:207 - 预热了 7 个活跃意图配置
2025-07-30 17:39:04,516 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-30 17:39:04,516 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 17:39:04,516 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 17:39:04,516 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 17:39:04,517 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 17:39:19,727 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868359727]
2025-07-30 17:39:19,882 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:39:19,884 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868359_b9c47d8a, 用户: test_user_003
2025-07-30 17:39:19,891 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_user_003
2025-07-30 17:39:19,894 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_bf2ce4833ddc for user: test_user_003
2025-07-30 17:39:19,916 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_user_003, 项目数: 12
2025-07-30 17:39:19,920 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_user_003, 项目数: 12
2025-07-30 17:39:19,920 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_bf2ce4833ddc
2025-07-30 17:39:19,927 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:39:19,927 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:39:25,851 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:625 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 17:39:25,851 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:640 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 17:39:25,853 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:334 - 意图识别完成: 查余额 -> Intent(book_flight: 订机票) (0.852)
2025-07-30 17:39:25,857 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.852 通过 intent-specific (book_flight)阈值 0.400 (等级: high)
2025-07-30 17:39:25,862 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.827, 主要类型=semantic, 信号数=15
2025-07-30 17:39:25,862 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.827, 主要类型=semantic, 候选数=1
2025-07-30 17:39:25,913 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查余额 -> book_flight
2025-07-30 17:39:25,917 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查余额 -> book_flight (置信度: 0.852)
2025-07-30 17:39:25,917 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查余额'
2025-07-30 17:39:25,917 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:39:25,930 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-30 17:39:25,949 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_user_003, 继承槽位=0, 应用规则=0
2025-07-30 17:39:26,219 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:711 - 实体提取完成: '查余额...' -> 0 个实体
2025-07-30 17:39:26,439 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1443 - LLM槽位提取结果: {}
2025-07-30 17:39:26,440 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 17:39:26,464 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6736ms [req_id=req_1753868359727]
2025-07-30 17:39:26,464 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6736ms
2025-07-30 17:39:26,465 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查余额', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 17:39:26,472 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 5
2025-07-30 17:40:13,892 - src.main - [32mINFO[0m - main.py:72 - 正在关闭系统...
2025-07-30 17:40:13,893 - src.services.cache_service - [32mINFO[0m - cache_service.py:87 - Redis连接已关闭
2025-07-30 17:40:13,893 - src.main - [32mINFO[0m - main.py:88 - 系统关闭完成
2025-07-30 17:40:16,302 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 17:40:16,307 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 17:40:16,354 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 17:40:16,408 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:40:16,409 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 17:40:16,409 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 17:40:16,410 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 17:40:16,440 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-30 17:40:16,444 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 17:40:16,446 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 17:40:16,446 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 17:40:16,447 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 17:40:16,447 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 17:40:16,447 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 17:40:16,447 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 17:40:16,447 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 17:40:16,447 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 17:40:16,747 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:241 - ✅ LLM连接测试成功
2025-07-30 17:40:16,754 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了7个意图到缓存
2025-07-30 17:40:16,777 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-30 17:40:16,778 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-30 17:40:16,804 - src.main - [32mINFO[0m - main.py:207 - 预热了 7 个活跃意图配置
2025-07-30 17:40:16,812 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-30 17:40:16,812 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 17:40:16,812 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 17:40:16,813 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 17:40:16,813 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 17:40:38,243 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868438243]
2025-07-30 17:40:38,319 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:40:38,320 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868438_9ff94e67, 用户: test_user_004
2025-07-30 17:40:38,326 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_user_004
2025-07-30 17:40:38,331 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_3e780dc38e97 for user: test_user_004
2025-07-30 17:40:38,352 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_user_004, 项目数: 12
2025-07-30 17:40:38,355 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_user_004, 项目数: 12
2025-07-30 17:40:38,356 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_3e780dc38e97
2025-07-30 17:40:38,363 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:40:38,363 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:40:44,486 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 17:40:44,487 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 17:40:44,489 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_flight: 订机票) -> Intent(check_balance: 查询账户余额)
2025-07-30 17:40:44,489 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 17:40:44,491 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 17:40:44,553 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查余额 -> check_balance
2025-07-30 17:40:44,556 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查余额 -> check_balance (置信度: 0.800)
2025-07-30 17:40:44,556 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查余额'
2025-07-30 17:40:44,556 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:40:44,571 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=2, 节点数=1, 边数=0
2025-07-30 17:40:44,587 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_user_004, 继承槽位=0, 应用规则=0
2025-07-30 17:40:44,909 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查余额...' -> 0 个实体
2025-07-30 17:40:45,120 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:40:45,121 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-30 17:40:45,181 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-30 17:40:45,348 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7105ms [req_id=req_1753868438243]
2025-07-30 17:40:45,349 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7105ms
2025-07-30 17:40:45,350 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 17:40:45,361 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-30 17:40:45,368 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=6, 成功=1/1
2025-07-30 17:40:45,368 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 6
2025-07-30 17:41:07,315 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868467315]
2025-07-30 17:41:07,316 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868467_b8a44b2f, 用户: test_user_005
2025-07-30 17:41:07,323 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_user_005
2025-07-30 17:41:07,389 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_c726bb552292 for user: test_user_005
2025-07-30 17:41:07,408 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_user_005, 项目数: 12
2025-07-30 17:41:07,411 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_user_005, 项目数: 12
2025-07-30 17:41:07,412 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_c726bb552292
2025-07-30 17:41:07,420 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:41:07,420 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:41:13,093 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 42.900, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:帮我预订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我想订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我要去北京，帮我订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:41:13,094 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:41:13,094 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:41:13,094 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:41:13,095 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 42.900
2025-07-30 17:41:13,097 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_generic: 通用订票) -> Intent(book_flight: 订机票)
2025-07-30 17:41:13,097 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 订机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 17:41:13,099 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 17:41:13,124 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订机票 -> book_flight
2025-07-30 17:41:13,130 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订机票 -> book_flight (置信度: 0.800)
2025-07-30 17:41:13,131 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订机票'
2025-07-30 17:41:13,131 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:41:13,147 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-30 17:41:13,258 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_user_005, 继承槽位=0, 应用规则=0
2025-07-30 17:41:13,494 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '订机票...' -> 0 个实体
2025-07-30 17:41:13,710 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:41:13,711 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 17:41:13,753 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6438ms [req_id=req_1753868467315]
2025-07-30 17:41:13,753 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6438ms
2025-07-30 17:41:13,754 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 17:41:13,762 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 7
2025-07-30 17:45:05,468 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 17:45:05,476 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 17:45:05,635 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 17:45:05,710 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:45:05,712 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 17:45:05,712 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 17:45:05,714 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 17:45:05,802 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-30 17:45:05,816 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 17:45:05,825 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 17:45:05,826 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 17:45:05,827 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 17:45:05,828 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 17:45:05,829 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 17:45:05,831 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 17:45:05,832 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 17:45:05,834 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 17:45:06,166 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:241 - ✅ LLM连接测试成功
2025-07-30 17:45:06,173 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了7个意图到缓存
2025-07-30 17:45:06,189 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-30 17:45:06,189 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-30 17:45:06,233 - src.main - [32mINFO[0m - main.py:207 - 预热了 7 个活跃意图配置
2025-07-30 17:45:06,243 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-30 17:45:06,244 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 17:45:06,244 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 17:45:06,245 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 17:45:06,246 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 17:45:22,327 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868722327]
2025-07-30 17:45:22,379 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:45:22,382 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868722_3d2d89b9, 用户: basic_intent_user_001
2025-07-30 17:45:22,387 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:140 - 找到用户最近活跃会话: sess_f9bee3bc4593
2025-07-30 17:45:22,402 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_f9bee3bc4593
2025-07-30 17:45:22,425 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:329 - 数据库记录 1: user_input='订机票', intent='book_generic', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 17:45:22,447 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史1轮
2025-07-30 17:45:22,448 - src.api.v1.chat - [32mINFO[0m - chat.py:962 - 检查轮次1: status=awaiting_confirmation, response_type=confirmation_prompt, intent=book_generic, user_input='订机票'
2025-07-30 17:45:22,449 - src.api.v1.chat - [32mINFO[0m - chat.py:1015 - 槽位补充检查: 未找到可补充的未完成意图
2025-07-30 17:45:28,338 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 42.900, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:帮我预订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我想订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我要去北京，帮我订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:45:28,340 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:45:28,340 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:45:28,341 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 17:45:28,342 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 42.900
2025-07-30 17:45:28,347 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_movie: 电影票预订) -> Intent(book_flight: 订机票)
2025-07-30 17:45:28,348 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 订机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 17:45:28,352 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 17:45:28,414 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订机票 -> book_flight
2025-07-30 17:45:28,420 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订机票 -> book_flight (置信度: 0.800)
2025-07-30 17:45:28,421 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订机票'
2025-07-30 17:45:28,422 - src.api.v1.chat - [32mINFO[0m - chat.py:833 - 确认检查: 最近对话状态=awaiting_confirmation, 响应类型=confirmation_prompt
2025-07-30 17:45:28,443 - src.api.v1.chat - [32mINFO[0m - chat.py:865 - 确认检查: 关键词匹配测试 - 用户输入='订机票', 确认关键词匹配=False
2025-07-30 17:45:28,528 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-30 17:45:28,577 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_001, 继承槽位=0, 应用规则=0
2025-07-30 17:45:28,959 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '订机票...' -> 0 个实体
2025-07-30 17:45:29,189 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:45:29,192 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 17:45:29,237 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6909ms [req_id=req_1753868722327]
2025-07-30 17:45:29,238 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6909ms
2025-07-30 17:45:29,241 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 17:45:29,252 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 8
2025-07-30 17:45:44,993 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868744993]
2025-07-30 17:45:44,997 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868744_3ee0d5b2, 用户: basic_intent_user_002
2025-07-30 17:45:45,001 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:140 - 找到用户最近活跃会话: sess_d4873ef2c54c
2025-07-30 17:45:45,012 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_d4873ef2c54c
2025-07-30 17:45:45,030 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:329 - 数据库记录 2: user_input='查余额', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 17:45:45,051 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史1轮
2025-07-30 17:45:45,052 - src.api.v1.chat - [32mINFO[0m - chat.py:962 - 检查轮次1: status=incomplete, response_type=slot_prompt, intent=book_flight, user_input='查余额'
2025-07-30 17:45:45,053 - src.api.v1.chat - [32mINFO[0m - chat.py:971 - 找到候选未完成意图: book_flight
2025-07-30 17:45:45,069 - src.api.v1.chat - [32mINFO[0m - chat.py:983 - 当前会话槽位: {}
2025-07-30 17:45:45,078 - src.api.v1.chat - [32mINFO[0m - chat.py:1000 - 必需槽位检查: 需要=['departure_city', 'arrival_city', 'departure_date'], 缺失=['departure_city', 'arrival_city', 'departure_date']
2025-07-30 17:45:45,079 - src.api.v1.chat - [32mINFO[0m - chat.py:1004 - ✅ 找到未完成意图: book_flight, 缺失槽位: ['departure_city', 'arrival_city', 'departure_date'], 间隔轮次: 0
2025-07-30 17:45:45,174 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_002, 继承槽位=0, 应用规则=0
2025-07-30 17:45:45,394 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查余额...' -> 0 个实体
2025-07-30 17:45:45,618 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:45:45,620 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 17:45:51,016 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 17:45:51,017 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 17:45:51,022 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_movie: 电影票预订) -> Intent(check_balance: 查询账户余额)
2025-07-30 17:45:51,023 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 17:45:51,028 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 17:45:51,139 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查余额 -> check_balance
2025-07-30 17:45:51,143 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查余额 -> check_balance (置信度: 0.800)
2025-07-30 17:45:51,144 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查余额'
2025-07-30 17:45:51,144 - src.api.v1.chat - [32mINFO[0m - chat.py:833 - 确认检查: 最近对话状态=incomplete, 响应类型=slot_prompt
2025-07-30 17:45:51,145 - src.api.v1.chat - [32mINFO[0m - chat.py:838 - 确认检查: 最近对话不是确认状态，跳过
2025-07-30 17:45:51,161 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=2, 节点数=1, 边数=0
2025-07-30 17:45:51,190 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_002, 继承槽位=0, 应用规则=0
2025-07-30 17:45:51,367 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查余额...' -> 0 个实体
2025-07-30 17:45:51,537 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:45:51,539 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-30 17:45:51,555 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-30 17:45:51,754 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6760ms [req_id=req_1753868744993]
2025-07-30 17:45:51,755 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6760ms
2025-07-30 17:45:51,757 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 17:45:51,774 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-30 17:45:51,791 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=2, 成功=1/1
2025-07-30 17:45:51,792 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 2
2025-07-30 17:46:08,691 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868768691]
2025-07-30 17:46:08,696 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868768_9e5cd3e4, 用户: basic_intent_user_003
2025-07-30 17:46:08,711 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_003
2025-07-30 17:46:08,754 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_b6665721842d for user: basic_intent_user_003
2025-07-30 17:46:08,792 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_003, 项目数: 12
2025-07-30 17:46:08,855 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_003, 项目数: 12
2025-07-30 17:46:08,856 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_b6665721842d
2025-07-30 17:46:08,876 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:46:08,876 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:46:14,504 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 改密码 -> Intent(book_movie: 电影票预订) (0.590)
2025-07-30 17:46:14,519 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.590 通过 intent-specific (book_movie)阈值 0.400 (等级: low) | 检测到歧义 (差值: 0.090, 阈值: 0.100)
2025-07-30 17:46:14,543 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.808, 主要类型=semantic, 信号数=11
2025-07-30 17:46:14,544 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.808, 主要类型=semantic, 候选数=2
2025-07-30 17:46:14,553 - src.services.intent_service - [32mINFO[0m - intent_service.py:539 - 增强歧义检测确认: 2个候选意图, 歧义得分=0.808, 主要类型=semantic
2025-07-30 17:46:14,555 - src.core.multi_strategy_resolver - [32mINFO[0m - multi_strategy_resolver.py:173 - 尝试策略: interactive
2025-07-30 17:46:14,556 - src.core.multi_strategy_resolver - [32mINFO[0m - multi_strategy_resolver.py:199 - 策略interactive失败: 需要用户交互确认
2025-07-30 17:46:14,558 - src.services.intent_service - [32mINFO[0m - intent_service.py:1217 - 自动解决尝试: 策略=escalation, 结果=failed, 置信度=0.000
2025-07-30 17:46:14,589 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 改密码 -> None
2025-07-30 17:46:14,594 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 改密码 -> None (置信度: 0.590)
2025-07-30 17:46:14,613 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:433 - 记录意图歧义: session=sess_b6665721842d, candidates_count=2
2025-07-30 17:46:14,616 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5924ms [req_id=req_1753868768691]
2025-07-30 17:46:14,617 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5924ms
2025-07-30 17:46:14,621 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='改密码', intent='None', status='ambiguous', response_type='disambiguation'
2025-07-30 17:46:14,637 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 10
2025-07-30 17:46:34,712 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868794712]
2025-07-30 17:46:34,718 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868794_3956bd35, 用户: basic_intent_user_004
2025-07-30 17:46:34,728 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_004
2025-07-30 17:46:34,764 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_bdff07896851 for user: basic_intent_user_004
2025-07-30 17:46:34,804 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_004, 项目数: 12
2025-07-30 17:46:34,808 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_004, 项目数: 12
2025-07-30 17:46:34,809 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_bdff07896851
2025-07-30 17:46:34,830 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:46:34,831 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:46:41,234 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 17:46:41,236 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 17:46:41,237 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 17:46:41,238 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.300, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'exact_match:买票', 'partial_in_example:我想买票']
2025-07-30 17:46:41,238 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 40.000
2025-07-30 17:46:41,243 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 买票 -> Intent(book_flight: 订机票) (0.865)
2025-07-30 17:46:41,259 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.865 通过 intent-specific (book_flight)阈值 0.400 (等级: high) | 检测到歧义 (差值: 0.065, 阈值: 0.100)
2025-07-30 17:46:41,281 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.814, 主要类型=semantic, 信号数=15
2025-07-30 17:46:41,282 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.814, 主要类型=semantic, 候选数=2
2025-07-30 17:46:41,291 - src.services.intent_service - [32mINFO[0m - intent_service.py:539 - 增强歧义检测确认: 2个候选意图, 歧义得分=0.814, 主要类型=semantic
2025-07-30 17:46:41,292 - src.core.multi_strategy_resolver - [32mINFO[0m - multi_strategy_resolver.py:173 - 尝试策略: interactive
2025-07-30 17:46:41,293 - src.core.multi_strategy_resolver - [32mINFO[0m - multi_strategy_resolver.py:199 - 策略interactive失败: 需要用户交互确认
2025-07-30 17:46:41,294 - src.services.intent_service - [32mINFO[0m - intent_service.py:1217 - 自动解决尝试: 策略=escalation, 结果=failed, 置信度=0.000
2025-07-30 17:46:41,317 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 买票 -> None
2025-07-30 17:46:41,323 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 买票 -> None (置信度: 0.865)
2025-07-30 17:46:41,343 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:433 - 记录意图歧义: session=sess_bdff07896851, candidates_count=2
2025-07-30 17:46:41,346 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6633ms [req_id=req_1753868794712]
2025-07-30 17:46:41,346 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6633ms
2025-07-30 17:46:41,350 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='买票', intent='None', status='ambiguous', response_type='disambiguation'
2025-07-30 17:46:41,364 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 12
2025-07-30 17:47:00,230 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868820230]
2025-07-30 17:47:00,234 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868820_0b2dbba0, 用户: basic_intent_user_005
2025-07-30 17:47:00,248 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_005
2025-07-30 17:47:00,260 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_f94348964c0b for user: basic_intent_user_005
2025-07-30 17:47:00,298 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_005, 项目数: 12
2025-07-30 17:47:00,364 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_005, 项目数: 12
2025-07-30 17:47:00,365 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_f94348964c0b
2025-07-30 17:47:00,381 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:47:00,382 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:47:06,024 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 60.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看']
2025-07-30 17:47:06,025 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 60.000
2025-07-30 17:47:06,030 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_flight: 订机票) -> Intent(check_balance: 查询账户余额)
2025-07-30 17:47:06,030 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查看余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 17:47:06,035 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 17:47:06,096 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查看余额 -> check_balance
2025-07-30 17:47:06,100 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查看余额 -> check_balance (置信度: 0.800)
2025-07-30 17:47:06,101 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查看余额'
2025-07-30 17:47:06,101 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:47:06,222 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_005, 继承槽位=0, 应用规则=0
2025-07-30 17:47:06,400 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查看余额...' -> 0 个实体
2025-07-30 17:47:06,612 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:47:06,613 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-30 17:47:06,721 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-30 17:47:06,724 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6493ms [req_id=req_1753868820230]
2025-07-30 17:47:06,724 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6493ms
2025-07-30 17:47:06,727 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查看余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 17:47:06,746 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-30 17:47:06,761 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=13, 成功=1/1
2025-07-30 17:47:06,761 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 13
2025-07-30 17:47:24,520 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753868844520]
2025-07-30 17:47:24,524 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753868844_6cdc4a5a, 用户: basic_intent_user_006
2025-07-30 17:47:24,536 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_006
2025-07-30 17:47:24,632 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_cbeb7e27cac2 for user: basic_intent_user_006
2025-07-30 17:47:24,667 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_006, 项目数: 12
2025-07-30 17:47:24,736 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_006, 项目数: 12
2025-07-30 17:47:24,737 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_cbeb7e27cac2
2025-07-30 17:47:24,757 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:47:24,757 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:47:31,260 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 修改密码 -> Intent(book_train: 火车票预订) (0.590)
2025-07-30 17:47:31,274 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.590 通过 intent-specific (book_train)阈值 0.400 (等级: low)
2025-07-30 17:47:31,285 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.829, 主要类型=semantic, 信号数=10
2025-07-30 17:47:31,286 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.829, 主要类型=semantic, 候选数=1
2025-07-30 17:47:31,393 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 修改密码 -> book_train
2025-07-30 17:47:31,397 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 修改密码 -> book_train (置信度: 0.590)
2025-07-30 17:47:31,398 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='修改密码'
2025-07-30 17:47:31,399 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:47:31,417 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.3 INSERT by slot_service
2025-07-30 17:47:31,431 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=3, 节点数=5, 边数=0
2025-07-30 17:47:31,455 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_006, 继承槽位=0, 应用规则=0
2025-07-30 17:47:31,618 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '修改密码...' -> 0 个实体
2025-07-30 17:47:31,831 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:47:31,832 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_train, 提取=0个, 继承=0个, 缺失=5个
2025-07-30 17:47:31,868 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7348ms [req_id=req_1753868844520]
2025-07-30 17:47:31,869 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7348ms
2025-07-30 17:47:31,873 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='修改密码', intent='book_train', status='incomplete', response_type='slot_prompt'
2025-07-30 17:47:31,888 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 14
2025-07-30 17:56:20,221 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869380221]
2025-07-30 17:56:20,225 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869380_05e9586a, 用户: test_change_password_001
2025-07-30 17:56:20,235 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_change_password_001
2025-07-30 17:56:20,698 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_173ab27f25d9 for user: test_change_password_001
2025-07-30 17:56:20,734 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_change_password_001, 项目数: 12
2025-07-30 17:56:20,802 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_change_password_001, 项目数: 12
2025-07-30 17:56:20,802 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_173ab27f25d9
2025-07-30 17:56:20,824 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:56:20,824 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:56:26,965 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 修改密码 -> Intent(book_movie: 电影票预订) (0.590)
2025-07-30 17:56:26,981 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.590 通过 intent-specific (book_movie)阈值 0.400 (等级: low)
2025-07-30 17:56:26,994 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.818, 主要类型=semantic, 信号数=10
2025-07-30 17:56:26,995 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.818, 主要类型=semantic, 候选数=1
2025-07-30 17:56:27,001 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 修改密码 -> book_movie
2025-07-30 17:56:27,006 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 修改密码 -> book_movie (置信度: 0.590)
2025-07-30 17:56:27,006 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='修改密码'
2025-07-30 17:56:27,007 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:56:27,026 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.4 INSERT by slot_service
2025-07-30 17:56:27,041 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=4, 节点数=5, 边数=0
2025-07-30 17:56:27,067 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_change_password_001, 继承槽位=0, 应用规则=0
2025-07-30 17:56:27,543 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '修改密码...' -> 0 个实体
2025-07-30 17:56:27,761 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:56:27,763 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_movie, 提取=0个, 继承=0个, 缺失=5个
2025-07-30 17:56:27,819 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7597ms [req_id=req_1753869380221]
2025-07-30 17:56:27,820 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7597ms
2025-07-30 17:56:27,823 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='修改密码', intent='book_movie', status='incomplete', response_type='slot_prompt'
2025-07-30 17:56:27,836 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 15
2025-07-30 17:56:32,463 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869392463]
2025-07-30 17:56:32,468 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869392_450fd3a6, 用户: test_change_password_002
2025-07-30 17:56:32,477 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_change_password_002
2025-07-30 17:56:32,576 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_3def241235d1 for user: test_change_password_002
2025-07-30 17:56:32,615 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_change_password_002, 项目数: 12
2025-07-30 17:56:32,683 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_change_password_002, 项目数: 12
2025-07-30 17:56:32,683 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_3def241235d1
2025-07-30 17:56:32,698 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 17:56:32,698 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 17:56:38,303 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 改密码 -> Intent(book_train: 火车票预订) (0.590)
2025-07-30 17:56:38,320 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.590 通过 intent-specific (book_train)阈值 0.400 (等级: low)
2025-07-30 17:56:38,335 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.829, 主要类型=semantic, 信号数=10
2025-07-30 17:56:38,336 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.829, 主要类型=semantic, 候选数=1
2025-07-30 17:56:38,436 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 改密码 -> book_train
2025-07-30 17:56:38,440 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 改密码 -> book_train (置信度: 0.590)
2025-07-30 17:56:38,441 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='改密码'
2025-07-30 17:56:38,443 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 17:56:38,517 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_change_password_002, 继承槽位=0, 应用规则=0
2025-07-30 17:56:38,655 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '改密码...' -> 0 个实体
2025-07-30 17:56:38,841 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 17:56:38,843 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_train, 提取=0个, 继承=0个, 缺失=5个
2025-07-30 17:56:38,967 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6503ms [req_id=req_1753869392463]
2025-07-30 17:56:38,967 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6503ms
2025-07-30 17:56:38,969 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='改密码', intent='book_train', status='incomplete', response_type='slot_prompt'
2025-07-30 17:56:38,981 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 16
2025-07-30 17:58:31,917 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 17:58:31,922 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 17:58:32,008 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 17:58:32,189 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 17:58:32,191 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 17:58:32,192 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 17:58:32,193 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 17:58:32,244 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-30 17:58:32,251 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 17:58:32,256 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 17:58:32,256 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 17:58:32,257 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 17:58:32,257 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 17:58:32,258 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 17:58:32,258 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 17:58:32,259 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 17:58:32,259 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 17:58:32,521 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:241 - ✅ LLM连接测试成功
2025-07-30 17:58:32,530 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了8个意图到缓存
2025-07-30 17:58:32,548 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-30 17:58:32,549 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-30 17:58:32,596 - src.main - [32mINFO[0m - main.py:207 - 预热了 7 个活跃意图配置
2025-07-30 17:58:32,610 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-30 17:58:32,611 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 17:58:32,612 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 17:58:32,613 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 17:58:32,614 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 18:01:02,068 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869662068]
2025-07-30 18:01:02,111 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 18:01:02,114 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869662_aace1583, 用户: basic_intent_user_001
2025-07-30 18:01:02,129 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_001
2025-07-30 18:01:02,196 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_1f30eddd0531 for user: basic_intent_user_001
2025-07-30 18:01:02,233 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_001, 项目数: 12
2025-07-30 18:01:02,299 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_001, 项目数: 12
2025-07-30 18:01:02,300 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_1f30eddd0531
2025-07-30 18:01:02,322 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:01:02,323 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:01:02,356 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: intents.0 INSERT by intent_service
2025-07-30 18:01:08,007 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 42.900, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:帮我预订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我想订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我要去北京，帮我订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:01:08,008 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:01:08,009 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:01:08,010 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:01:08,011 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 42.900
2025-07-30 18:01:08,016 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_train: 火车票预订) -> Intent(book_flight: 订机票)
2025-07-30 18:01:08,017 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 订机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:01:08,021 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:01:08,033 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订机票 -> book_flight
2025-07-30 18:01:08,039 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订机票 -> book_flight (置信度: 0.800)
2025-07-30 18:01:08,040 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订机票'
2025-07-30 18:01:08,040 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:01:08,062 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.1 INSERT by slot_service
2025-07-30 18:01:08,146 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-30 18:01:08,180 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_001, 继承槽位=0, 应用规则=0
2025-07-30 18:01:08,514 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '订机票...' -> 0 个实体
2025-07-30 18:01:08,711 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:01:08,715 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 18:01:08,798 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6729ms [req_id=req_1753869662068]
2025-07-30 18:01:08,798 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6729ms
2025-07-30 18:01:08,801 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 18:01:08,811 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 1
2025-07-30 18:01:20,854 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869680854]
2025-07-30 18:01:20,858 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869680_258ef3a3, 用户: basic_intent_user_002
2025-07-30 18:01:20,869 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_002
2025-07-30 18:01:20,877 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_9d807ffb391d for user: basic_intent_user_002
2025-07-30 18:01:20,915 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_002, 项目数: 12
2025-07-30 18:01:20,919 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_002, 项目数: 12
2025-07-30 18:01:20,920 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_9d807ffb391d
2025-07-30 18:01:20,939 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:01:20,940 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:01:25,880 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 18:01:25,881 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 18:01:25,884 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(check_balance: 查询账户余额)
2025-07-30 18:01:25,885 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 18:01:25,889 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 18:01:25,892 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查余额 -> check_balance
2025-07-30 18:01:25,895 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查余额 -> check_balance (置信度: 0.800)
2025-07-30 18:01:25,896 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查余额'
2025-07-30 18:01:25,896 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:01:25,916 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.2 INSERT by slot_service
2025-07-30 18:01:25,936 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=2, 节点数=1, 边数=0
2025-07-30 18:01:25,973 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_002, 继承槽位=0, 应用规则=0
2025-07-30 18:01:26,161 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查余额...' -> 0 个实体
2025-07-30 18:01:26,370 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:01:26,373 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-30 18:01:26,400 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-30 18:01:26,661 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5806ms [req_id=req_1753869680854]
2025-07-30 18:01:26,661 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5806ms
2025-07-30 18:01:26,665 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 18:01:26,689 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-30 18:01:26,711 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=2, 成功=1/1
2025-07-30 18:01:26,712 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 2
2025-07-30 18:01:41,502 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869701502]
2025-07-30 18:01:41,507 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869701_37bdbc94, 用户: basic_intent_user_003
2025-07-30 18:01:41,517 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_003
2025-07-30 18:01:41,553 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_17ce8231263b for user: basic_intent_user_003
2025-07-30 18:01:41,643 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_003, 项目数: 12
2025-07-30 18:01:41,647 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_003, 项目数: 12
2025-07-30 18:01:41,647 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_17ce8231263b
2025-07-30 18:01:41,663 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:01:41,663 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:01:45,799 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 change_password 得分: 2.200, 匹配关键词: ['partial_in_example:修改密码', 'exact_match:改密码', 'partial_in_example:更改密码', 'partial_in_example:我要改密码', 'partial_in_example:我想修改密码']
2025-07-30 18:01:45,800 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: change_password, 最佳得分: 2.200
2025-07-30 18:01:45,805 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(change_password: 修改密码)
2025-07-30 18:01:45,806 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 改密码 -> Intent(change_password: 修改密码) (0.800)
2025-07-30 18:01:45,811 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (change_password)阈值 0.700 (等级: medium)
2025-07-30 18:01:45,917 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 改密码 -> change_password
2025-07-30 18:01:45,921 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 改密码 -> change_password (置信度: 0.800)
2025-07-30 18:01:45,921 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='改密码'
2025-07-30 18:01:45,922 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:01:45,939 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.8 INSERT by slot_service
2025-07-30 18:01:46,023 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=8, 节点数=3, 边数=0
2025-07-30 18:01:46,055 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_003, 继承槽位=0, 应用规则=0
2025-07-30 18:01:46,254 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '改密码...' -> 0 个实体
2025-07-30 18:01:46,473 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:01:46,475 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: change_password, 提取=0个, 继承=0个, 缺失=3个
2025-07-30 18:01:46,666 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5164ms [req_id=req_1753869701502]
2025-07-30 18:01:46,667 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5164ms
2025-07-30 18:01:46,669 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='改密码', intent='change_password', status='incomplete', response_type='slot_prompt'
2025-07-30 18:01:46,682 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 3
2025-07-30 18:02:05,516 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869725516]
2025-07-30 18:02:05,520 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869725_62279595, 用户: basic_intent_user_004
2025-07-30 18:02:05,533 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_004
2025-07-30 18:02:05,568 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_44b0f8c64222 for user: basic_intent_user_004
2025-07-30 18:02:05,606 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_004, 项目数: 12
2025-07-30 18:02:05,671 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_004, 项目数: 12
2025-07-30 18:02:05,672 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_44b0f8c64222
2025-07-30 18:02:05,688 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:02:05,688 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:02:11,730 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 18:02:11,731 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 18:02:11,733 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 18:02:11,733 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.300, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'exact_match:买票', 'partial_in_example:我想买票']
2025-07-30 18:02:11,734 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 40.000
2025-07-30 18:02:11,740 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 买票 -> Intent(book_flight: 订机票) (0.865)
2025-07-30 18:02:11,754 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.865 通过 intent-specific (book_flight)阈值 0.400 (等级: high) | 检测到歧义 (差值: 0.065, 阈值: 0.100)
2025-07-30 18:02:11,771 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.814, 主要类型=semantic, 信号数=15
2025-07-30 18:02:11,772 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.814, 主要类型=semantic, 候选数=2
2025-07-30 18:02:11,781 - src.services.intent_service - [32mINFO[0m - intent_service.py:539 - 增强歧义检测确认: 2个候选意图, 歧义得分=0.814, 主要类型=semantic
2025-07-30 18:02:11,781 - src.core.multi_strategy_resolver - [32mINFO[0m - multi_strategy_resolver.py:173 - 尝试策略: interactive
2025-07-30 18:02:11,782 - src.core.multi_strategy_resolver - [32mINFO[0m - multi_strategy_resolver.py:199 - 策略interactive失败: 需要用户交互确认
2025-07-30 18:02:11,784 - src.services.intent_service - [32mINFO[0m - intent_service.py:1217 - 自动解决尝试: 策略=escalation, 结果=failed, 置信度=0.000
2025-07-30 18:02:11,813 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 买票 -> None
2025-07-30 18:02:11,819 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 买票 -> None (置信度: 0.865)
2025-07-30 18:02:11,843 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:433 - 记录意图歧义: session=sess_44b0f8c64222, candidates_count=2
2025-07-30 18:02:11,847 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6331ms [req_id=req_1753869725516]
2025-07-30 18:02:11,848 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6331ms
2025-07-30 18:02:11,854 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='买票', intent='None', status='ambiguous', response_type='disambiguation'
2025-07-30 18:02:11,871 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 5
2025-07-30 18:02:24,277 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869744277]
2025-07-30 18:02:24,283 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869744_09ef05d1, 用户: basic_intent_user_005
2025-07-30 18:02:24,293 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_005
2025-07-30 18:02:24,421 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_2ea7aeada08e for user: basic_intent_user_005
2025-07-30 18:02:24,465 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_005, 项目数: 12
2025-07-30 18:02:24,511 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_005, 项目数: 12
2025-07-30 18:02:24,512 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_2ea7aeada08e
2025-07-30 18:02:24,537 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:02:24,537 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:02:28,795 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 60.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:看']
2025-07-30 18:02:28,797 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 60.000
2025-07-30 18:02:28,802 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(check_balance: 查询账户余额)
2025-07-30 18:02:28,802 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查看余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 18:02:28,807 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 18:02:28,914 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查看余额 -> check_balance
2025-07-30 18:02:28,919 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查看余额 -> check_balance (置信度: 0.800)
2025-07-30 18:02:28,920 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查看余额'
2025-07-30 18:02:28,921 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:02:28,964 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_005, 继承槽位=0, 应用规则=0
2025-07-30 18:02:29,126 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查看余额...' -> 0 个实体
2025-07-30 18:02:29,310 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:02:29,312 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-30 18:02:29,334 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-30 18:02:29,338 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5060ms [req_id=req_1753869744277]
2025-07-30 18:02:29,339 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5060ms
2025-07-30 18:02:29,342 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查看余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 18:02:29,366 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-30 18:02:29,382 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=6, 成功=1/1
2025-07-30 18:02:29,383 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 6
2025-07-30 18:02:44,321 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869764321]
2025-07-30 18:02:44,325 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869764_27c18482, 用户: basic_intent_user_006
2025-07-30 18:02:44,337 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: basic_intent_user_006
2025-07-30 18:02:44,385 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_94d0a0e1b0d9 for user: basic_intent_user_006
2025-07-30 18:02:44,422 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: basic_intent_user_006, 项目数: 12
2025-07-30 18:02:44,477 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: basic_intent_user_006, 项目数: 12
2025-07-30 18:02:44,478 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_94d0a0e1b0d9
2025-07-30 18:02:44,532 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:02:44,533 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:02:48,725 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 change_password 得分: 1.900, 匹配关键词: ['exact_match:修改密码', 'example_in_input:改密码', 'partial_in_example:我想修改密码']
2025-07-30 18:02:48,726 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: change_password, 最佳得分: 1.900
2025-07-30 18:02:48,731 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(change_password: 修改密码)
2025-07-30 18:02:48,732 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 修改密码 -> Intent(change_password: 修改密码) (0.800)
2025-07-30 18:02:48,736 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (change_password)阈值 0.700 (等级: medium)
2025-07-30 18:02:48,778 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 修改密码 -> change_password
2025-07-30 18:02:48,782 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 修改密码 -> change_password (置信度: 0.800)
2025-07-30 18:02:48,782 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='修改密码'
2025-07-30 18:02:48,783 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:02:48,904 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=basic_intent_user_006, 继承槽位=0, 应用规则=0
2025-07-30 18:02:49,061 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '修改密码...' -> 0 个实体
2025-07-30 18:02:49,243 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:02:49,245 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: change_password, 提取=0个, 继承=0个, 缺失=3个
2025-07-30 18:02:49,281 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 4959ms [req_id=req_1753869764321]
2025-07-30 18:02:49,282 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 4959ms
2025-07-30 18:02:49,284 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='修改密码', intent='change_password', status='incomplete', response_type='slot_prompt'
2025-07-30 18:02:49,296 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 7
2025-07-30 18:03:30,469 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869810469]
2025-07-30 18:03:30,473 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869810_1bc619a7, 用户: complete_intent_user_001
2025-07-30 18:03:30,484 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: complete_intent_user_001
2025-07-30 18:03:30,557 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_2996734fdb17 for user: complete_intent_user_001
2025-07-30 18:03:30,594 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: complete_intent_user_001, 项目数: 12
2025-07-30 18:03:30,659 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: complete_intent_user_001, 项目数: 12
2025-07-30 18:03:30,660 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_2996734fdb17
2025-07-30 18:03:30,717 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:03:30,717 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:03:36,441 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 60.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:03:36,443 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:03:36,444 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:03:36,445 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:03:36,445 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 60.000
2025-07-30 18:03:36,450 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_generic: 通用订票) -> Intent(book_flight: 订机票)
2025-07-30 18:03:36,451 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我要订明天从北京到上海的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:03:36,455 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:03:36,599 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我要订明天从北京到上海的机票 -> book_flight
2025-07-30 18:03:36,603 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我要订明天从北京到上海的机票 -> book_flight (置信度: 0.800)
2025-07-30 18:03:36,603 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我要订明天从北京到上海的机票'
2025-07-30 18:03:36,604 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:03:36,648 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=complete_intent_user_001, 继承槽位=0, 应用规则=0
2025-07-30 18:03:42,595 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我要订明天从北京到上海的机票...' -> 3 个实体
2025-07-30 18:03:50,336 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'arrival_city': {'value': '上海', 'confidence': 0.95, 'source': 'entity', 'original_text': '上海'}, 'departure_city': {'value': '北京', 'confidence': 0.95, 'source': 'entity', 'original_text': '北京'}, 'departure_date': {'value': '2025-07-31', 'confidence': 0.95, 'source': 'text', 'original_text': '明天'}}
2025-07-30 18:03:50,339 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=3个, 继承=0个, 缺失=3个
2025-07-30 18:03:50,435 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 passenger_count 应用默认值: 1
2025-07-30 18:03:50,436 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 trip_type 应用默认值: single
2025-07-30 18:03:50,440 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 19970ms [req_id=req_1753869810469]
2025-07-30 18:03:50,440 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 19970ms
2025-07-30 18:03:50,443 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我要订明天从北京到上海的机票', intent='book_flight', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 18:03:50,480 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'arrival_city': SlotInfo(name='arrival_city', original_text='上海', extracted_value='上海', normalized_value='上海', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='上海', source='entity', is_validated=True, validation_error=None), 'departure_city': SlotInfo(name='departure_city', original_text='北京', extracted_value='北京', normalized_value='北京', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='北京', source='entity', is_validated=True, validation_error=None), 'departure_date': SlotInfo(name='departure_date', original_text='明天', extracted_value='明天', normalized_value='2025-07-31', confidence=0.95, extraction_method='text', validation=None, is_confirmed=True, value='2025-07-31', source='text', is_validated=True, validation_error=None), 'passenger_count': SlotInfo(name='passenger_count', original_text='1', extracted_value='1', normalized_value='1', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='1', source='default', is_validated=True, validation_error=None), 'trip_type': SlotInfo(name='trip_type', original_text='single', extracted_value='single', normalized_value='single', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='single', source='default', is_validated=True, validation_error=None)}
2025-07-30 18:03:50,627 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=8, 成功=5/5
2025-07-30 18:03:50,628 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 8
2025-07-30 18:04:14,016 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869854016]
2025-07-30 18:04:14,021 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869854_93ecd43a, 用户: complete_intent_user_002
2025-07-30 18:04:14,031 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: complete_intent_user_002
2025-07-30 18:04:14,085 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_7bd2f563080d for user: complete_intent_user_002
2025-07-30 18:04:14,119 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: complete_intent_user_002, 项目数: 12
2025-07-30 18:04:14,181 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: complete_intent_user_002, 项目数: 12
2025-07-30 18:04:14,182 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_7bd2f563080d
2025-07-30 18:04:14,202 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:04:14,202 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:04:20,130 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 18:04:20,131 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 18:04:20,134 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(goodbye: 再见) -> Intent(check_balance: 查询账户余额)
2025-07-30 18:04:20,134 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查一下招商银行储蓄卡的余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 18:04:20,138 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 18:04:20,222 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查一下招商银行储蓄卡的余额 -> check_balance
2025-07-30 18:04:20,227 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查一下招商银行储蓄卡的余额 -> check_balance (置信度: 0.800)
2025-07-30 18:04:20,227 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查一下招商银行储蓄卡的余额'
2025-07-30 18:04:20,228 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:04:20,352 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=complete_intent_user_002, 继承槽位=0, 应用规则=0
2025-07-30 18:04:26,945 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查一下招商银行储蓄卡的余额...' -> 2 个实体
2025-07-30 18:04:29,825 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'account_type': {'value': '储蓄卡', 'confidence': 0.95, 'source': 'text', 'original_text': '储蓄卡'}}
2025-07-30 18:04:29,827 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=1个, 继承=0个, 缺失=0个
2025-07-30 18:04:29,865 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 15848ms [req_id=req_1753869854016]
2025-07-30 18:04:29,866 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 15848ms
2025-07-30 18:04:29,869 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查一下招商银行储蓄卡的余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 18:04:29,891 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='储蓄卡', extracted_value='储蓄卡', normalized_value='储蓄卡', confidence=0.95, extraction_method='text', validation=None, is_confirmed=True, value='储蓄卡', source='text', is_validated=True, validation_error=None)}
2025-07-30 18:04:29,910 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=9, 成功=1/1
2025-07-30 18:04:29,911 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 9
2025-07-30 18:04:42,908 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869882908]
2025-07-30 18:04:42,913 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869882_73ee70a4, 用户: complete_intent_user_003
2025-07-30 18:04:42,925 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: complete_intent_user_003
2025-07-30 18:04:42,955 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_b73dad20606c for user: complete_intent_user_003
2025-07-30 18:04:42,992 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: complete_intent_user_003, 项目数: 12
2025-07-30 18:04:43,058 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: complete_intent_user_003, 项目数: 12
2025-07-30 18:04:43,059 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_b73dad20606c
2025-07-30 18:04:43,077 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:04:43,078 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:04:47,750 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 帮我改一下登录密码 -> Intent(check_balance: 查询账户余额) (0.620)
2025-07-30 18:04:47,765 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.620 未通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 18:04:47,869 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 帮我改一下登录密码 -> None
2025-07-30 18:04:47,873 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 帮我改一下登录密码 -> None (置信度: 0.620)
2025-07-30 18:04:47,874 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='帮我改一下登录密码'
2025-07-30 18:04:47,874 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:04:47,875 - src.api.v1.chat - [32mINFO[0m - chat.py:329 - 跳过RAGFLOW调用，使用降级处理
2025-07-30 18:04:47,877 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 4968ms [req_id=req_1753869882908]
2025-07-30 18:04:47,877 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 4968ms
2025-07-30 18:04:47,880 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='帮我改一下登录密码', intent='None', status='non_intent_input', response_type='qa_response'
2025-07-30 18:04:47,895 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 10
2025-07-30 18:05:45,670 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869945670]
2025-07-30 18:05:45,674 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869945_fb1ef454, 用户: complete_intent_user_004
2025-07-30 18:05:45,686 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: complete_intent_user_004
2025-07-30 18:05:45,725 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_d53151f737db for user: complete_intent_user_004
2025-07-30 18:05:45,768 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: complete_intent_user_004, 项目数: 12
2025-07-30 18:05:45,827 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: complete_intent_user_004, 项目数: 12
2025-07-30 18:05:45,828 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_d53151f737db
2025-07-30 18:05:45,844 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:05:45,845 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:05:52,169 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 60.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:05:52,170 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:05:52,171 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:05:52,172 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:05:52,172 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 60.000
2025-07-30 18:05:52,176 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_generic: 通用订票) -> Intent(book_flight: 订机票)
2025-07-30 18:05:52,176 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 订后天下午从深圳到广州的经济舱机票，1个人 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:05:52,180 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:05:52,279 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订后天下午从深圳到广州的经济舱机票，1个人 -> book_flight
2025-07-30 18:05:52,282 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订后天下午从深圳到广州的经济舱机票，1个人 -> book_flight (置信度: 0.800)
2025-07-30 18:05:52,283 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订后天下午从深圳到广州的经济舱机票，1个人'
2025-07-30 18:05:52,283 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:05:52,312 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.1 INSERT by slot_service
2025-07-30 18:05:52,346 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=complete_intent_user_004, 继承槽位=0, 应用规则=0
2025-07-30 18:05:55,517 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869955517]
2025-07-30 18:05:55,522 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869955_fb8302ff, 用户: test_change_password_003
2025-07-30 18:05:55,530 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_change_password_003
2025-07-30 18:05:55,556 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_80894af897f2 for user: test_change_password_003
2025-07-30 18:05:55,598 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_change_password_003, 项目数: 12
2025-07-30 18:05:55,661 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_change_password_003, 项目数: 12
2025-07-30 18:05:55,661 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_80894af897f2
2025-07-30 18:05:55,677 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:05:55,677 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:05:55,769 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: intents.0 INSERT by intent_service
2025-07-30 18:06:01,305 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 帮我改一下登录密码 -> Intent(book_movie: 电影票预订) (0.620)
2025-07-30 18:06:01,333 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.620 通过 intent-specific (book_movie)阈值 0.400 (等级: medium)
2025-07-30 18:06:01,357 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.827, 主要类型=semantic, 信号数=10
2025-07-30 18:06:01,358 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.827, 主要类型=semantic, 候选数=1
2025-07-30 18:06:01,393 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 帮我改一下登录密码 -> book_movie
2025-07-30 18:06:01,397 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 帮我改一下登录密码 -> book_movie (置信度: 0.620)
2025-07-30 18:06:01,397 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='帮我改一下登录密码'
2025-07-30 18:06:01,398 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:06:01,414 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.4 INSERT by slot_service
2025-07-30 18:06:01,514 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=4, 节点数=5, 边数=0
2025-07-30 18:06:01,624 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_change_password_003, 继承槽位=0, 应用规则=0
2025-07-30 18:06:01,819 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '帮我改一下登录密码...' -> 1 个实体
2025-07-30 18:06:02,109 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:06:02,111 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_movie, 提取=0个, 继承=0个, 缺失=5个
2025-07-30 18:06:02,153 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6636ms [req_id=req_1753869955517]
2025-07-30 18:06:02,154 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6636ms
2025-07-30 18:06:02,158 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='帮我改一下登录密码', intent='book_movie', status='incomplete', response_type='slot_prompt'
2025-07-30 18:06:02,172 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 11
2025-07-30 18:06:02,199 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '订后天下午从深圳到广州的经济舱机票，1个人...' -> 4 个实体
2025-07-30 18:06:14,549 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'arrival_city': {'value': '广州', 'confidence': 0.95, 'source': 'entity', 'original_text': '广州'}, 'departure_city': {'value': '深圳', 'confidence': 0.95, 'source': 'entity', 'original_text': '深圳'}, 'departure_date': {'value': '2025-08-01', 'confidence': 0.95, 'source': 'text', 'original_text': '后天下午'}, 'passenger_count': {'value': 1, 'confidence': 0.95, 'source': 'entity', 'original_text': '1个'}, 'trip_type': {'value': 'one_way', 'confidence': 0.95, 'source': 'text', 'original_text': '经济舱机票'}}
2025-07-30 18:06:14,550 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=5个, 继承=0个, 缺失=1个
2025-07-30 18:06:14,626 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 28956ms [req_id=req_1753869945670]
2025-07-30 18:06:14,627 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 28956ms
2025-07-30 18:06:14,629 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订后天下午从深圳到广州的经济舱机票，1个人', intent='book_flight', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 18:06:14,650 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'arrival_city': SlotInfo(name='arrival_city', original_text='广州', extracted_value='广州', normalized_value='广州', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='广州', source='entity', is_validated=True, validation_error=None), 'departure_city': SlotInfo(name='departure_city', original_text='深圳', extracted_value='深圳', normalized_value='深圳', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='深圳', source='entity', is_validated=True, validation_error=None), 'departure_date': SlotInfo(name='departure_date', original_text='后天下午', extracted_value='后天下午', normalized_value='2025-08-01', confidence=0.95, extraction_method='text', validation=None, is_confirmed=True, value='2025-08-01', source='text', is_validated=True, validation_error=None), 'passenger_count': SlotInfo(name='passenger_count', original_text='1个', extracted_value='1个', normalized_value='1', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='1', source='entity', is_validated=True, validation_error=None), 'trip_type': SlotInfo(name='trip_type', original_text='经济舱机票', extracted_value='经济舱机票', normalized_value='single', confidence=0.95, extraction_method='text', validation=None, is_confirmed=True, value='single', source='text', is_validated=True, validation_error=None)}
2025-07-30 18:06:14,715 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=12, 成功=5/5
2025-07-30 18:06:14,716 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 12
2025-07-30 18:06:22,183 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/admin/intent-evaluation/change_password [req_id=req_1753869982183]
2025-07-30 18:06:22,185 - src.api.exceptions - [33mWARNING[0m - exceptions.py:51 - Starlette异常: 404 - Not Found - http://localhost:8000/api/v1/admin/intent-evaluation/change_password
2025-07-30 18:06:22,186 - request - [32mINFO[0m - logger.py:137 - RESPONSE 404 2ms [req_id=req_1753869982183]
2025-07-30 18:06:22,186 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/admin/intent-evaluation/change_password FAILURE 2ms
2025-07-30 18:06:26,131 - request - [32mINFO[0m - logger.py:131 - REQUEST GET http://localhost:8000/api/v1/health [req_id=req_1753869986131]
2025-07-30 18:06:26,134 - request - [32mINFO[0m - logger.py:137 - RESPONSE 307 2ms [req_id=req_1753869986131]
2025-07-30 18:06:26,135 - performance - [32mINFO[0m - logger.py:167 - API_CALL GET /api/v1/health SUCCESS 2ms
2025-07-30 18:06:30,714 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753869990714]
2025-07-30 18:06:30,719 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753869990_00af1e62, 用户: test_simple
2025-07-30 18:06:30,727 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_simple
2025-07-30 18:06:30,782 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_9b27863fdf68 for user: test_simple
2025-07-30 18:06:30,823 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_simple, 项目数: 12
2025-07-30 18:06:30,884 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_simple, 项目数: 12
2025-07-30 18:06:30,885 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_9b27863fdf68
2025-07-30 18:06:30,902 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:06:30,902 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:06:35,124 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 change_password 得分: 1.900, 匹配关键词: ['exact_match:修改密码', 'example_in_input:改密码', 'partial_in_example:我想修改密码']
2025-07-30 18:06:35,124 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: change_password, 最佳得分: 1.900
2025-07-30 18:06:35,129 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(change_password: 修改密码)
2025-07-30 18:06:35,130 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 修改密码 -> Intent(change_password: 修改密码) (0.800)
2025-07-30 18:06:35,135 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (change_password)阈值 0.700 (等级: medium)
2025-07-30 18:06:35,184 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 修改密码 -> change_password
2025-07-30 18:06:35,187 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 修改密码 -> change_password (置信度: 0.800)
2025-07-30 18:06:35,188 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='修改密码'
2025-07-30 18:06:35,189 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:06:35,202 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.8 INSERT by slot_service
2025-07-30 18:06:35,288 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_simple, 继承槽位=0, 应用规则=0
2025-07-30 18:06:35,467 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '修改密码...' -> 0 个实体
2025-07-30 18:06:35,676 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:06:35,677 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: change_password, 提取=0个, 继承=0个, 缺失=3个
2025-07-30 18:06:35,727 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5013ms [req_id=req_1753869990714]
2025-07-30 18:06:35,728 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5013ms
2025-07-30 18:06:35,730 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='修改密码', intent='change_password', status='incomplete', response_type='slot_prompt'
2025-07-30 18:06:35,741 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 13
2025-07-30 18:06:40,020 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870000020]
2025-07-30 18:06:40,024 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870000_3067177c, 用户: test_simple2
2025-07-30 18:06:40,033 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_simple2
2025-07-30 18:06:40,100 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_f506c0ff6d4c for user: test_simple2
2025-07-30 18:06:40,134 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_simple2, 项目数: 12
2025-07-30 18:06:40,139 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_simple2, 项目数: 12
2025-07-30 18:06:40,140 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_f506c0ff6d4c
2025-07-30 18:06:40,157 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:06:40,159 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:06:45,134 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 change_password 得分: 2.200, 匹配关键词: ['partial_in_example:修改密码', 'exact_match:改密码', 'partial_in_example:更改密码', 'partial_in_example:我要改密码', 'partial_in_example:我想修改密码']
2025-07-30 18:06:45,135 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: change_password, 最佳得分: 2.200
2025-07-30 18:06:45,140 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(change_password: 修改密码)
2025-07-30 18:06:45,140 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 改密码 -> Intent(change_password: 修改密码) (0.800)
2025-07-30 18:06:45,146 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (change_password)阈值 0.700 (等级: medium)
2025-07-30 18:06:45,220 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 改密码 -> change_password
2025-07-30 18:06:45,224 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 改密码 -> change_password (置信度: 0.800)
2025-07-30 18:06:45,224 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='改密码'
2025-07-30 18:06:45,225 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:06:45,270 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_simple2, 继承槽位=0, 应用规则=0
2025-07-30 18:06:45,451 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '改密码...' -> 0 个实体
2025-07-30 18:06:45,645 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:06:45,646 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: change_password, 提取=0个, 继承=0个, 缺失=3个
2025-07-30 18:06:45,764 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5743ms [req_id=req_1753870000020]
2025-07-30 18:06:45,764 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5743ms
2025-07-30 18:06:45,767 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='改密码', intent='change_password', status='incomplete', response_type='slot_prompt'
2025-07-30 18:06:45,780 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 14
2025-07-30 18:06:56,757 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870016757]
2025-07-30 18:06:56,761 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870016_5dcf4277, 用户: test_help_change
2025-07-30 18:06:56,770 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_help_change
2025-07-30 18:06:56,777 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_18fdfa5ea6b7 for user: test_help_change
2025-07-30 18:06:56,815 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_help_change, 项目数: 12
2025-07-30 18:06:56,819 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_help_change, 项目数: 12
2025-07-30 18:06:56,820 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_18fdfa5ea6b7
2025-07-30 18:06:56,837 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:06:56,838 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:06:57,621 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: intents.0 INSERT by intent_service
2025-07-30 18:07:03,548 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 帮我改一下登录密码 -> Intent(book_movie: 电影票预订) (0.620)
2025-07-30 18:07:03,568 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.620 通过 intent-specific (book_movie)阈值 0.400 (等级: medium)
2025-07-30 18:07:03,590 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.827, 主要类型=semantic, 信号数=10
2025-07-30 18:07:03,591 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.827, 主要类型=semantic, 候选数=1
2025-07-30 18:07:03,653 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 帮我改一下登录密码 -> book_movie
2025-07-30 18:07:03,656 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 帮我改一下登录密码 -> book_movie (置信度: 0.620)
2025-07-30 18:07:03,657 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='帮我改一下登录密码'
2025-07-30 18:07:03,658 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:07:03,675 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.4 INSERT by slot_service
2025-07-30 18:07:03,857 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_help_change, 继承槽位=0, 应用规则=0
2025-07-30 18:07:04,033 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '帮我改一下登录密码...' -> 1 个实体
2025-07-30 18:07:04,248 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:07:04,249 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_movie, 提取=0个, 继承=0个, 缺失=5个
2025-07-30 18:07:04,296 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7538ms [req_id=req_1753870016757]
2025-07-30 18:07:04,296 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7538ms
2025-07-30 18:07:04,299 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='帮我改一下登录密码', intent='book_movie', status='incomplete', response_type='slot_prompt'
2025-07-30 18:07:04,309 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 15
2025-07-30 18:09:53,487 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870193487]
2025-07-30 18:09:53,491 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870193_a3fa3ca9, 用户: test_simple_password
2025-07-30 18:09:53,501 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_simple_password
2025-07-30 18:09:53,534 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_e3bb2507dc11 for user: test_simple_password
2025-07-30 18:09:53,565 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_simple_password, 项目数: 12
2025-07-30 18:09:53,568 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_simple_password, 项目数: 12
2025-07-30 18:09:53,569 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_e3bb2507dc11
2025-07-30 18:09:53,584 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:09:53,585 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:09:53,749 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: intents.0 INSERT by intent_service
2025-07-30 18:09:59,539 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 change_password 得分: 1.900, 匹配关键词: ['exact_match:修改密码', 'example_in_input:改密码', 'partial_in_example:我想修改密码']
2025-07-30 18:09:59,540 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: change_password, 最佳得分: 1.900
2025-07-30 18:09:59,543 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_movie: 电影票预订) -> Intent(change_password: 修改密码)
2025-07-30 18:09:59,544 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 修改密码 -> Intent(change_password: 修改密码) (0.800)
2025-07-30 18:09:59,547 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (change_password)阈值 0.700 (等级: medium)
2025-07-30 18:09:59,581 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 修改密码 -> change_password
2025-07-30 18:09:59,884 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 修改密码 -> change_password (置信度: 0.800)
2025-07-30 18:09:59,885 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='修改密码'
2025-07-30 18:09:59,886 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:09:59,907 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.8 INSERT by slot_service
2025-07-30 18:09:59,941 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_simple_password, 继承槽位=0, 应用规则=0
2025-07-30 18:10:00,281 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '修改密码...' -> 0 个实体
2025-07-30 18:10:00,498 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:10:00,499 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: change_password, 提取=0个, 继承=0个, 缺失=3个
2025-07-30 18:10:00,637 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7149ms [req_id=req_1753870193487]
2025-07-30 18:10:00,638 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7149ms
2025-07-30 18:10:00,640 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='修改密码', intent='change_password', status='incomplete', response_type='slot_prompt'
2025-07-30 18:10:00,652 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 16
2025-07-30 18:10:44,002 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-30 18:10:44,007 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-30 18:10:44,114 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-30 18:10:44,241 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 18:10:44,242 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-30 18:10:44,242 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-30 18:10:44,243 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-30 18:10:44,249 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 0个同义词, 0个词组
2025-07-30 18:10:44,253 - src.services.synonym_service - [33mWARNING[0m - synonym_service.py:143 - 数据库中无停用词，使用默认停用词
2025-07-30 18:10:44,254 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-30 18:10:44,259 - src.services.synonym_service - [33mWARNING[0m - synonym_service.py:181 - 数据库中无实体模式，使用默认模式
2025-07-30 18:10:44,260 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-30 18:10:44,261 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-30 18:10:44,261 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-30 18:10:44,262 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-30 18:10:44,262 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-30 18:10:44,263 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-30 18:10:44,263 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-30 18:10:44,264 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-30 18:10:44,955 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:241 - ✅ LLM连接测试成功
2025-07-30 18:10:44,966 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了8个意图到缓存
2025-07-30 18:10:44,988 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-30 18:10:44,989 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-30 18:10:44,999 - src.main - [32mINFO[0m - main.py:207 - 预热了 8 个活跃意图配置
2025-07-30 18:10:45,051 - src.main - [32mINFO[0m - main.py:214 - 预热了 0 个系统配置
2025-07-30 18:10:45,061 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-30 18:10:45,062 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-30 18:10:45,062 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-30 18:10:45,063 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-30 18:11:19,595 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870279595]
2025-07-30 18:11:19,737 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-30 18:11:19,739 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870279_fb49331a, 用户: partial_intent_user_001
2025-07-30 18:11:19,753 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_001
2025-07-30 18:11:19,802 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_26a20aa5d689 for user: partial_intent_user_001
2025-07-30 18:11:19,845 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_001, 项目数: 12
2025-07-30 18:11:19,904 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_001, 项目数: 12
2025-07-30 18:11:19,905 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_26a20aa5d689
2025-07-30 18:11:19,925 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:11:19,926 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:11:25,356 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 55.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'exact_match:我想订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:11:25,358 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:11:25,359 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:11:25,359 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:11:25,360 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 55.000
2025-07-30 18:11:25,365 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_train: 火车票预订) -> Intent(book_flight: 订机票)
2025-07-30 18:11:25,366 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我想订机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:11:25,370 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:11:25,375 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我想订机票 -> book_flight
2025-07-30 18:11:25,379 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我想订机票 -> book_flight (置信度: 0.800)
2025-07-30 18:11:25,379 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我想订机票'
2025-07-30 18:11:25,380 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:11:25,645 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.1 INSERT by slot_service
2025-07-30 18:11:25,666 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-30 18:11:25,704 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_001, 继承槽位=0, 应用规则=0
2025-07-30 18:11:26,050 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我想订机票...' -> 0 个实体
2025-07-30 18:11:26,266 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:11:26,269 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 18:11:26,323 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6727ms [req_id=req_1753870279595]
2025-07-30 18:11:26,323 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6727ms
2025-07-30 18:11:26,327 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我想订机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 18:11:26,337 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 17
2025-07-30 18:11:36,815 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870296815]
2025-07-30 18:11:36,819 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870296_8dd64aa8, 用户: partial_intent_user_002
2025-07-30 18:11:36,829 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_002
2025-07-30 18:11:36,958 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_1505d68d7e93 for user: partial_intent_user_002
2025-07-30 18:11:36,999 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_002, 项目数: 12
2025-07-30 18:11:37,062 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_002, 项目数: 12
2025-07-30 18:11:37,063 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_1505d68d7e93
2025-07-30 18:11:37,083 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:11:37,084 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:11:42,432 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 40.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票']
2025-07-30 18:11:42,433 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-30 18:11:42,434 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-30 18:11:42,435 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 7.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-30 18:11:42,436 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 40.000
2025-07-30 18:11:42,440 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(check_balance: 查询账户余额) -> Intent(book_flight: 订机票)
2025-07-30 18:11:42,442 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我要去上海的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:11:42,446 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:11:42,502 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我要去上海的机票 -> book_flight
2025-07-30 18:11:42,511 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我要去上海的机票 -> book_flight (置信度: 0.800)
2025-07-30 18:11:42,512 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我要去上海的机票'
2025-07-30 18:11:42,514 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:11:42,562 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_002, 继承槽位=0, 应用规则=0
2025-07-30 18:11:48,248 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我要去上海的机票...' -> 1 个实体
2025-07-30 18:11:50,710 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'arrival_city': {'value': '上海', 'confidence': 0.95, 'source': 'entity', 'original_text': '上海'}}
2025-07-30 18:11:50,712 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=1个, 继承=0个, 缺失=5个
2025-07-30 18:11:50,807 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 13992ms [req_id=req_1753870296815]
2025-07-30 18:11:50,808 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 13992ms
2025-07-30 18:11:50,811 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我要去上海的机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 18:11:50,831 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'arrival_city': SlotInfo(name='arrival_city', original_text='上海', extracted_value='上海', normalized_value='上海', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='上海', source='entity', is_validated=True, validation_error=None)}
2025-07-30 18:11:50,848 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=18, 成功=1/1
2025-07-30 18:11:50,848 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 18
2025-07-30 18:12:10,635 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870330635]
2025-07-30 18:12:10,640 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870330_993ecd39, 用户: partial_intent_user_003
2025-07-30 18:12:10,650 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_003
2025-07-30 18:12:10,750 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_1e42ba02b42c for user: partial_intent_user_003
2025-07-30 18:12:10,786 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_003, 项目数: 12
2025-07-30 18:12:10,853 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_003, 项目数: 12
2025-07-30 18:12:10,854 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_1e42ba02b42c
2025-07-30 18:12:10,883 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:12:10,883 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:12:15,946 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 60.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:12:15,947 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:12:15,949 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:12:15,950 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:12:15,951 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 60.000
2025-07-30 18:12:15,958 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(check_balance: 查询账户余额) -> Intent(book_flight: 订机票)
2025-07-30 18:12:15,960 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 订明天的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:12:15,967 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:12:16,079 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订明天的机票 -> book_flight
2025-07-30 18:12:16,083 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订明天的机票 -> book_flight (置信度: 0.800)
2025-07-30 18:12:16,084 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订明天的机票'
2025-07-30 18:12:16,086 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:12:16,213 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_003, 继承槽位=0, 应用规则=0
2025-07-30 18:12:16,473 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '订明天的机票...' -> 1 个实体
2025-07-30 18:12:19,746 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'departure_date': {'value': '2025-07-31', 'confidence': 0.95, 'source': 'text', 'original_text': '明天'}}
2025-07-30 18:12:19,749 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=1个, 继承=0个, 缺失=5个
2025-07-30 18:12:19,792 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 9157ms [req_id=req_1753870330635]
2025-07-30 18:12:19,793 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 9157ms
2025-07-30 18:12:19,796 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订明天的机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 18:12:19,819 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'departure_date': SlotInfo(name='departure_date', original_text='明天', extracted_value='明天', normalized_value='2025-07-31', confidence=0.95, extraction_method='text', validation=None, is_confirmed=True, value='2025-07-31', source='text', is_validated=True, validation_error=None)}
2025-07-30 18:12:19,844 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=19, 成功=1/1
2025-07-30 18:12:19,845 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 19
2025-07-30 18:12:31,937 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870351937]
2025-07-30 18:12:31,942 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870351_f7d1812a, 用户: partial_intent_user_004
2025-07-30 18:12:31,956 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_004
2025-07-30 18:12:32,050 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_acc191dd6045 for user: partial_intent_user_004
2025-07-30 18:12:32,096 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_004, 项目数: 12
2025-07-30 18:12:32,152 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_004, 项目数: 12
2025-07-30 18:12:32,153 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_acc191dd6045
2025-07-30 18:12:32,174 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:12:32,175 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:12:36,780 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 18:12:36,783 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 18:12:36,791 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(greeting: 问候) -> Intent(check_balance: 查询账户余额)
2025-07-30 18:12:36,792 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 帮我查余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 18:12:36,800 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 18:12:36,862 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 帮我查余额 -> check_balance
2025-07-30 18:12:36,865 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 帮我查余额 -> check_balance (置信度: 0.800)
2025-07-30 18:12:36,866 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='帮我查余额'
2025-07-30 18:12:36,866 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:12:36,879 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.2 INSERT by slot_service
2025-07-30 18:12:36,893 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=2, 节点数=1, 边数=0
2025-07-30 18:12:36,922 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_004, 继承槽位=0, 应用规则=0
2025-07-30 18:12:37,085 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '帮我查余额...' -> 0 个实体
2025-07-30 18:12:37,268 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:12:37,268 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-30 18:12:37,286 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-30 18:12:37,499 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5561ms [req_id=req_1753870351937]
2025-07-30 18:12:37,499 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5561ms
2025-07-30 18:12:37,501 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='帮我查余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 18:12:37,516 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-30 18:12:37,527 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=20, 成功=1/1
2025-07-30 18:12:37,528 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 20
2025-07-30 18:13:39,177 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870419177]
2025-07-30 18:13:39,184 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870419_fdc2ec95, 用户: test_multi_slots
2025-07-30 18:13:39,197 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_multi_slots
2025-07-30 18:13:39,225 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_45cb41b53ed4 for user: test_multi_slots
2025-07-30 18:13:39,269 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_multi_slots, 项目数: 12
2025-07-30 18:13:39,331 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_multi_slots, 项目数: 12
2025-07-30 18:13:39,333 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_45cb41b53ed4
2025-07-30 18:13:39,360 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:13:39,360 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:13:45,040 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 18:13:45,042 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 18:13:45,050 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(check_balance: 查询账户余额)
2025-07-30 18:13:45,052 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 帮我查余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 18:13:45,063 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 18:13:45,163 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 帮我查余额 -> check_balance
2025-07-30 18:13:45,168 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 帮我查余额 -> check_balance (置信度: 0.800)
2025-07-30 18:13:45,169 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='帮我查余额'
2025-07-30 18:13:45,170 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:13:45,221 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_multi_slots, 继承槽位=0, 应用规则=0
2025-07-30 18:13:45,454 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '帮我查余额...' -> 0 个实体
2025-07-30 18:13:45,666 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:13:45,668 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-30 18:13:45,789 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-30 18:13:45,793 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6616ms [req_id=req_1753870419177]
2025-07-30 18:13:45,793 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6616ms
2025-07-30 18:13:45,797 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='帮我查余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 18:13:45,819 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-30 18:13:45,838 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=21, 成功=1/1
2025-07-30 18:13:45,839 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 21
2025-07-30 18:13:47,654 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870427654]
2025-07-30 18:13:47,659 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870427_7b147f12, 用户: partial_intent_user_005
2025-07-30 18:13:47,670 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_005
2025-07-30 18:13:47,678 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_74d7421cea93 for user: partial_intent_user_005
2025-07-30 18:13:47,717 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_005, 项目数: 12
2025-07-30 18:13:47,729 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_005, 项目数: 12
2025-07-30 18:13:47,729 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_74d7421cea93
2025-07-30 18:13:47,747 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:13:47,748 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:13:51,413 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870431413]
2025-07-30 18:13:51,417 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870431_3c92ccb2, 用户: test_multi_slots2
2025-07-30 18:13:51,425 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_multi_slots2
2025-07-30 18:13:51,513 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_519e62459c9b for user: test_multi_slots2
2025-07-30 18:13:51,551 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_multi_slots2, 项目数: 12
2025-07-30 18:13:51,616 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_multi_slots2, 项目数: 12
2025-07-30 18:13:51,618 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_519e62459c9b
2025-07-30 18:13:51,646 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:13:51,647 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:13:52,159 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 change_password 得分: 1.900, 匹配关键词: ['exact_match:修改密码', 'example_in_input:改密码', 'partial_in_example:我想修改密码']
2025-07-30 18:13:52,160 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: change_password, 最佳得分: 1.900
2025-07-30 18:13:52,164 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(change_password: 修改密码)
2025-07-30 18:13:52,165 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 修改密码 -> Intent(change_password: 修改密码) (0.800)
2025-07-30 18:13:52,170 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (change_password)阈值 0.700 (等级: medium)
2025-07-30 18:13:52,229 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 修改密码 -> change_password
2025-07-30 18:13:52,232 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 修改密码 -> change_password (置信度: 0.800)
2025-07-30 18:13:52,233 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='修改密码'
2025-07-30 18:13:52,233 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:13:52,252 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=8, 节点数=3, 边数=0
2025-07-30 18:13:52,343 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_005, 继承槽位=0, 应用规则=0
2025-07-30 18:13:52,546 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '修改密码...' -> 0 个实体
2025-07-30 18:13:52,808 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:13:52,809 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: change_password, 提取=0个, 继承=0个, 缺失=3个
2025-07-30 18:13:52,833 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5178ms [req_id=req_1753870427654]
2025-07-30 18:13:52,833 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5178ms
2025-07-30 18:13:52,836 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='修改密码', intent='change_password', status='incomplete', response_type='slot_prompt'
2025-07-30 18:13:52,849 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 22
2025-07-30 18:13:57,800 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 42.900, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:帮我预订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我想订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'partial_in_example:我要去北京，帮我订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:13:57,801 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:13:57,802 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:13:57,803 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-30 18:13:57,804 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 42.900
2025-07-30 18:13:57,807 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_train: 火车票预订) -> Intent(book_flight: 订机票)
2025-07-30 18:13:57,808 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 订机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:13:57,812 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:13:57,863 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订机票 -> book_flight
2025-07-30 18:13:57,867 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订机票 -> book_flight (置信度: 0.800)
2025-07-30 18:13:57,868 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订机票'
2025-07-30 18:13:57,868 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:13:57,910 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_multi_slots2, 继承槽位=0, 应用规则=0
2025-07-30 18:13:58,098 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '订机票...' -> 0 个实体
2025-07-30 18:13:58,301 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:13:58,302 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 18:13:58,416 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7003ms [req_id=req_1753870431413]
2025-07-30 18:13:58,417 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7003ms
2025-07-30 18:13:58,420 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 18:13:58,435 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 23
2025-07-30 18:14:04,204 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870444204]
2025-07-30 18:14:04,207 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870444_c87ae4b5, 用户: partial_intent_user_006
2025-07-30 18:14:04,219 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_006
2025-07-30 18:14:04,315 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_1d0a980e0041 for user: partial_intent_user_006
2025-07-30 18:14:04,351 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_006, 项目数: 12
2025-07-30 18:14:04,354 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_006, 项目数: 12
2025-07-30 18:14:04,355 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_1d0a980e0041
2025-07-30 18:14:04,371 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:14:04,371 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:14:10,624 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 40.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票']
2025-07-30 18:14:10,626 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-30 18:14:10,627 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-30 18:14:10,628 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 7.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-30 18:14:10,629 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 40.000
2025-07-30 18:14:10,633 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_generic: 通用订票) -> Intent(book_flight: 订机票)
2025-07-30 18:14:10,634 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 从北京出发的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:14:10,639 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:14:10,660 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 从北京出发的机票 -> book_flight
2025-07-30 18:14:10,665 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 从北京出发的机票 -> book_flight (置信度: 0.800)
2025-07-30 18:14:10,666 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='从北京出发的机票'
2025-07-30 18:14:10,667 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:14:10,712 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_006, 继承槽位=0, 应用规则=0
2025-07-30 18:14:13,612 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '从北京出发的机票...' -> 1 个实体
2025-07-30 18:14:16,139 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'departure_city': {'value': '北京', 'confidence': 0.95, 'source': 'entity', 'original_text': '北京'}}
2025-07-30 18:14:16,142 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=1个, 继承=0个, 缺失=5个
2025-07-30 18:14:16,217 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 12013ms [req_id=req_1753870444204]
2025-07-30 18:14:16,218 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 12013ms
2025-07-30 18:14:16,221 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='从北京出发的机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 18:14:16,242 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'departure_city': SlotInfo(name='departure_city', original_text='北京', extracted_value='北京', normalized_value='北京', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='北京', source='entity', is_validated=True, validation_error=None)}
2025-07-30 18:14:16,259 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=24, 成功=1/1
2025-07-30 18:14:16,260 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 24
2025-07-30 18:14:23,593 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870463593]
2025-07-30 18:14:23,597 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870463_8ead7731, 用户: partial_intent_user_007
2025-07-30 18:14:23,608 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_007
2025-07-30 18:14:23,665 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_944ac1ac5975 for user: partial_intent_user_007
2025-07-30 18:14:23,702 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_007, 项目数: 12
2025-07-30 18:14:23,767 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_007, 项目数: 12
2025-07-30 18:14:23,768 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_944ac1ac5975
2025-07-30 18:14:23,783 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:14:23,784 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:14:27,911 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-30 18:14:27,912 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-30 18:14:27,916 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(check_balance: 查询账户余额)
2025-07-30 18:14:27,917 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查招商银行的余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-30 18:14:27,921 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-30 18:14:28,074 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查招商银行的余额 -> check_balance
2025-07-30 18:14:28,080 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查招商银行的余额 -> check_balance (置信度: 0.800)
2025-07-30 18:14:28,081 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查招商银行的余额'
2025-07-30 18:14:28,082 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:14:28,128 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_007, 继承槽位=0, 应用规则=0
2025-07-30 18:14:30,980 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查招商银行的余额...' -> 1 个实体
2025-07-30 18:14:33,663 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'account_type': {'value': '招商银行', 'confidence': 0.95, 'source': 'entity', 'original_text': '查招商银行'}}
2025-07-30 18:14:33,665 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=1个, 继承=0个, 缺失=0个
2025-07-30 18:14:33,714 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 10121ms [req_id=req_1753870463593]
2025-07-30 18:14:33,715 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 10121ms
2025-07-30 18:14:33,718 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查招商银行的余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-30 18:14:33,738 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='查招商银行', extracted_value='查招商银行', normalized_value='查招商银行', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='查招商银行', source='entity', is_validated=True, validation_error=None)}
2025-07-30 18:14:33,757 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=25, 成功=1/1
2025-07-30 18:14:33,758 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 25
2025-07-30 18:15:57,757 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753870557757]
2025-07-30 18:15:57,761 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753870557_020d1015, 用户: test_multi_slots3
2025-07-30 18:15:57,773 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_multi_slots3
2025-07-30 18:15:57,877 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_777b36570992 for user: test_multi_slots3
2025-07-30 18:15:57,918 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_multi_slots3, 项目数: 12
2025-07-30 18:15:57,976 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_multi_slots3, 项目数: 12
2025-07-30 18:15:57,977 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_777b36570992
2025-07-30 18:15:57,994 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-30 18:15:57,994 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-30 18:16:03,127 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 55.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买', 'exact_match:我要买机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 18:16:03,128 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 18:16:03,129 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 18:16:03,130 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:买']
2025-07-30 18:16:03,131 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 55.000
2025-07-30 18:16:03,136 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_generic: 通用订票) -> Intent(book_flight: 订机票)
2025-07-30 18:16:03,136 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我要买机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-30 18:16:03,142 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-30 18:16:03,146 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我要买机票 -> book_flight
2025-07-30 18:16:03,152 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我要买机票 -> book_flight (置信度: 0.800)
2025-07-30 18:16:03,153 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我要买机票'
2025-07-30 18:16:03,154 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-30 18:16:03,247 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_multi_slots3, 继承槽位=0, 应用规则=0
2025-07-30 18:16:03,448 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我要买机票...' -> 0 个实体
2025-07-30 18:16:03,634 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-30 18:16:03,636 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-30 18:16:03,746 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5989ms [req_id=req_1753870557757]
2025-07-30 18:16:03,747 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5989ms
2025-07-30 18:16:03,750 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我要买机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-30 18:16:03,764 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 26
2025-07-31 10:05:25,461 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-31 10:05:25,470 - src.main - [31mERROR[0m - main.py:66 - 系统启动失败: (2003, "Can't connect to MySQL server on 'localhost' ([Errno 61] Connection refused)")
2025-07-31 10:05:58,866 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-31 10:05:58,880 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-31 10:05:59,073 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-31 10:05:59,213 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-31 10:05:59,214 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-31 10:05:59,215 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-31 10:05:59,216 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-31 10:05:59,238 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 0个同义词, 0个词组
2025-07-31 10:05:59,246 - src.services.synonym_service - [33mWARNING[0m - synonym_service.py:143 - 数据库中无停用词，使用默认停用词
2025-07-31 10:05:59,247 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-31 10:05:59,260 - src.services.synonym_service - [33mWARNING[0m - synonym_service.py:181 - 数据库中无实体模式，使用默认模式
2025-07-31 10:05:59,261 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-31 10:05:59,262 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-31 10:05:59,264 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-31 10:05:59,265 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-31 10:05:59,266 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-31 10:05:59,267 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-31 10:05:59,268 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-31 10:05:59,269 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-31 10:06:30,219 - src.core.nlu_engine - [31mERROR[0m - nlu_engine.py:82 - LLM异步调用异常: 
2025-07-31 10:06:30,220 - src.core.nlu_engine - [33mWARNING[0m - nlu_engine.py:244 - ⚠️ LLM连接测试失败: Error: 
2025-07-31 10:06:30,250 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了8个意图到缓存
2025-07-31 10:06:30,352 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-31 10:06:30,353 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-31 10:06:30,443 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: intents.0 INSERT by intent_service
2025-07-31 10:06:30,444 - src.main - [32mINFO[0m - main.py:207 - 预热了 8 个活跃意图配置
2025-07-31 10:06:30,453 - src.main - [32mINFO[0m - main.py:214 - 预热了 0 个系统配置
2025-07-31 10:06:30,454 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-31 10:06:30,454 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-31 10:06:30,455 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-31 10:06:30,455 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-31 10:09:38,197 - src.main - [32mINFO[0m - main.py:72 - 正在关闭系统...
2025-07-31 10:09:38,198 - src.services.cache_service - [32mINFO[0m - cache_service.py:87 - Redis连接已关闭
2025-07-31 10:09:38,199 - src.main - [32mINFO[0m - main.py:88 - 系统关闭完成
2025-07-31 10:16:04,810 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-31 10:16:04,814 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-31 10:16:04,960 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-31 10:16:05,001 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-31 10:16:05,001 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-31 10:16:05,002 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-31 10:16:05,002 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-31 10:16:05,032 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-31 10:16:05,036 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-31 10:16:05,039 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-31 10:16:05,039 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-31 10:16:05,040 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-31 10:16:05,040 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-31 10:16:05,040 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-31 10:16:05,040 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-31 10:16:05,040 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-31 10:16:05,040 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-31 10:16:35,201 - src.core.nlu_engine - [31mERROR[0m - nlu_engine.py:82 - LLM异步调用异常: 
2025-07-31 10:16:35,202 - src.core.nlu_engine - [33mWARNING[0m - nlu_engine.py:244 - ⚠️ LLM连接测试失败: Error: 
2025-07-31 10:16:35,206 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了8个意图到缓存
2025-07-31 10:16:35,224 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-31 10:16:35,225 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-31 10:16:35,313 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: intents.0 INSERT by intent_service
2025-07-31 10:16:35,314 - src.main - [32mINFO[0m - main.py:207 - 预热了 8 个活跃意图配置
2025-07-31 10:16:35,319 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-31 10:16:35,320 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-31 10:16:35,320 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-31 10:16:35,320 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-31 10:16:35,320 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-31 10:16:42,491 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753928202491]
2025-07-31 10:16:42,584 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-31 10:16:42,585 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753928202_36f98bbd, 用户: test_user_001
2025-07-31 10:16:42,594 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: test_user_001
2025-07-31 10:16:42,599 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_b59d517daead for user: test_user_001
2025-07-31 10:16:42,624 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: test_user_001, 项目数: 12
2025-07-31 10:16:42,626 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: test_user_001, 项目数: 12
2025-07-31 10:16:42,627 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_b59d517daead
2025-07-31 10:16:42,633 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 10:16:42,634 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 10:17:13,201 - src.core.nlu_engine - [31mERROR[0m - nlu_engine.py:82 - LLM异步调用异常: 
2025-07-31 10:17:13,202 - src.core.nlu_engine - [31mERROR[0m - nlu_engine.py:450 - LLM响应JSON解析失败: Expecting value: line 1 column 1 (char 0), 响应: Error: 
2025-07-31 10:17:13,206 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 60.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 10:17:13,206 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 10:17:13,207 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 10:17:13,207 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 10:17:13,207 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 60.000
2025-07-31 10:17:13,209 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(book_flight: 订机票)
2025-07-31 10:17:13,210 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我要订明天从北京到上海的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-31 10:17:13,212 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-31 10:17:13,294 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我要订明天从北京到上海的机票 -> book_flight
2025-07-31 10:17:13,298 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我要订明天从北京到上海的机票 -> book_flight (置信度: 0.800)
2025-07-31 10:17:13,298 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我要订明天从北京到上海的机票'
2025-07-31 10:17:13,299 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 10:17:13,317 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.1 INSERT by slot_service
2025-07-31 10:17:13,333 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-31 10:17:13,422 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=test_user_001, 继承槽位=0, 应用规则=0
2025-07-31 10:17:44,201 - src.core.nlu_engine - [31mERROR[0m - nlu_engine.py:82 - LLM异步调用异常: 
2025-07-31 10:17:44,202 - src.core.nlu_engine - [33mWARNING[0m - nlu_engine.py:1205 - LLM实体响应JSON解析失败: Expecting value: line 1 column 1 (char 0), 响应: Error: 
2025-07-31 10:17:44,270 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我要订明天从北京到上海的机票...' -> 3 个实体
2025-07-31 10:18:15,200 - src.core.nlu_engine - [31mERROR[0m - nlu_engine.py:82 - LLM异步调用异常: 
2025-07-31 10:18:15,201 - src.core.nlu_engine - [31mERROR[0m - nlu_engine.py:1548 - 槽位响应JSON解析失败: Expecting value: line 1 column 1 (char 0), 响应: Error: 
2025-07-31 10:18:15,201 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 10:18:15,202 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-31 10:18:15,268 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 92776ms [req_id=req_1753928202491]
2025-07-31 10:18:15,268 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 92776ms
2025-07-31 10:18:15,269 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我要订明天从北京到上海的机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-31 10:18:15,275 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 1
2025-07-31 11:10:08,106 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-31 11:10:08,115 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-31 11:10:08,304 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-31 11:10:08,482 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-31 11:10:08,484 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-31 11:10:08,486 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-31 11:10:08,488 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-31 11:10:08,547 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-31 11:10:08,557 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-31 11:10:08,563 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-31 11:10:08,563 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-31 11:10:08,564 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-31 11:10:08,565 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-31 11:10:08,565 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-31 11:10:08,566 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-31 11:10:08,567 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-31 11:10:08,568 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-31 11:10:39,152 - src.core.nlu_engine - [31mERROR[0m - nlu_engine.py:82 - LLM异步调用异常: 
2025-07-31 11:10:39,155 - src.core.nlu_engine - [33mWARNING[0m - nlu_engine.py:244 - ⚠️ LLM连接测试失败: Error: 
2025-07-31 11:10:39,165 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了8个意图到缓存
2025-07-31 11:10:39,183 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-31 11:10:39,183 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-31 11:10:39,208 - src.main - [32mINFO[0m - main.py:207 - 预热了 8 个活跃意图配置
2025-07-31 11:10:39,224 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-31 11:10:39,225 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-31 11:10:39,226 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-31 11:10:39,227 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-31 11:10:39,228 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-31 11:13:42,310 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753931622310]
2025-07-31 11:13:42,410 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-31 11:13:42,414 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753931622_4b91a795, 用户: partial_intent_user_001
2025-07-31 11:13:42,429 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_001
2025-07-31 11:13:42,497 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_7506b59b2bae for user: partial_intent_user_001
2025-07-31 11:13:42,535 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_001, 项目数: 12
2025-07-31 11:13:42,600 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_001, 项目数: 12
2025-07-31 11:13:42,602 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_7506b59b2bae
2025-07-31 11:13:42,630 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:13:42,630 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:13:48,331 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 55.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'exact_match:我想订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:13:48,332 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:13:48,333 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:13:48,334 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:13:48,335 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 55.000
2025-07-31 11:13:48,340 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_movie: 电影票预订) -> Intent(book_flight: 订机票)
2025-07-31 11:13:48,341 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我想订机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-31 11:13:48,348 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-31 11:13:48,436 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我想订机票 -> book_flight
2025-07-31 11:13:48,440 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我想订机票 -> book_flight (置信度: 0.800)
2025-07-31 11:13:48,441 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我想订机票'
2025-07-31 11:13:48,442 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:13:48,467 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-31 11:13:48,507 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_001, 继承槽位=0, 应用规则=0
2025-07-31 11:13:49,137 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我想订机票...' -> 0 个实体
2025-07-31 11:13:49,349 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:13:49,352 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-31 11:13:49,395 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7085ms [req_id=req_1753931622310]
2025-07-31 11:13:49,396 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7085ms
2025-07-31 11:13:49,398 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我想订机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-31 11:13:49,409 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 2
2025-07-31 11:14:09,224 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753931649224]
2025-07-31 11:14:09,228 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753931649_3022fa00, 用户: partial_intent_user_002
2025-07-31 11:14:09,239 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_002
2025-07-31 11:14:09,325 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_b1fdd3a0f21d for user: partial_intent_user_002
2025-07-31 11:14:09,362 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_002, 项目数: 12
2025-07-31 11:14:09,366 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_002, 项目数: 12
2025-07-31 11:14:09,367 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_b1fdd3a0f21d
2025-07-31 11:14:09,382 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:14:09,383 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:14:13,751 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 40.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票']
2025-07-31 11:14:13,753 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:14:13,754 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:14:13,755 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 7.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:14:13,756 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 40.000
2025-07-31 11:14:13,761 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(check_balance: 查询账户余额) -> Intent(book_flight: 订机票)
2025-07-31 11:14:13,762 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我要去上海的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-31 11:14:13,767 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-31 11:14:13,831 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我要去上海的机票 -> book_flight
2025-07-31 11:14:13,835 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我要去上海的机票 -> book_flight (置信度: 0.800)
2025-07-31 11:14:13,836 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我要去上海的机票'
2025-07-31 11:14:13,837 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:14:13,961 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_002, 继承槽位=0, 应用规则=0
2025-07-31 11:14:19,671 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我要去上海的机票...' -> 1 个实体
2025-07-31 11:14:22,027 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'arrival_city': {'value': '上海', 'confidence': 0.95, 'source': 'entity', 'original_text': '上海'}}
2025-07-31 11:14:22,028 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=1个, 继承=0个, 缺失=5个
2025-07-31 11:14:22,149 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 12924ms [req_id=req_1753931649224]
2025-07-31 11:14:22,150 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 12924ms
2025-07-31 11:14:22,152 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我要去上海的机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-31 11:14:22,171 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'arrival_city': SlotInfo(name='arrival_city', original_text='上海', extracted_value='上海', normalized_value='上海', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='上海', source='entity', is_validated=True, validation_error=None)}
2025-07-31 11:14:22,186 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=3, 成功=1/1
2025-07-31 11:14:22,186 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 3
2025-07-31 11:14:37,607 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753931677607]
2025-07-31 11:14:37,612 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753931677_ad427952, 用户: partial_intent_user_003
2025-07-31 11:14:37,624 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_003
2025-07-31 11:14:37,691 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_559a44ca3392 for user: partial_intent_user_003
2025-07-31 11:14:37,728 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_003, 项目数: 12
2025-07-31 11:14:37,793 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_003, 项目数: 12
2025-07-31 11:14:37,795 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_559a44ca3392
2025-07-31 11:14:37,825 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:14:37,825 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:14:43,110 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 60.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:14:43,112 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:14:43,113 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:14:43,113 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:14:43,115 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 60.000
2025-07-31 11:14:43,120 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(check_balance: 查询账户余额) -> Intent(book_flight: 订机票)
2025-07-31 11:14:43,121 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 订明天的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-31 11:14:43,126 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-31 11:14:43,220 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 订明天的机票 -> book_flight
2025-07-31 11:14:43,224 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 订明天的机票 -> book_flight (置信度: 0.800)
2025-07-31 11:14:43,224 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='订明天的机票'
2025-07-31 11:14:43,225 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:14:43,270 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_003, 继承槽位=0, 应用规则=0
2025-07-31 11:14:43,465 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '订明天的机票...' -> 1 个实体
2025-07-31 11:14:46,453 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'departure_date': {'value': '2025-07-31', 'confidence': 0.95, 'source': 'entity', 'original_text': '明天'}}
2025-07-31 11:14:46,455 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=1个, 继承=0个, 缺失=5个
2025-07-31 11:14:46,529 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 8921ms [req_id=req_1753931677607]
2025-07-31 11:14:46,530 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 8921ms
2025-07-31 11:14:46,534 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='订明天的机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-31 11:14:46,555 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'departure_date': SlotInfo(name='departure_date', original_text='明天', extracted_value='明天', normalized_value='2025-08-01', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='2025-08-01', source='entity', is_validated=True, validation_error=None)}
2025-07-31 11:14:46,577 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=4, 成功=1/1
2025-07-31 11:14:46,577 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 4
2025-07-31 11:15:08,548 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753931708548]
2025-07-31 11:15:08,553 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753931708_5540407d, 用户: partial_intent_user_004
2025-07-31 11:15:08,563 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_004
2025-07-31 11:15:08,616 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_585c24960a90 for user: partial_intent_user_004
2025-07-31 11:15:08,655 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_004, 项目数: 12
2025-07-31 11:15:08,721 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_004, 项目数: 12
2025-07-31 11:15:08,722 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_585c24960a90
2025-07-31 11:15:08,740 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:15:08,741 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:15:14,616 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-31 11:15:14,617 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-31 11:15:14,621 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_flight: 订机票) -> Intent(check_balance: 查询账户余额)
2025-07-31 11:15:14,621 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 帮我查余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-31 11:15:14,625 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-31 11:15:14,660 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 帮我查余额 -> check_balance
2025-07-31 11:15:14,667 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 帮我查余额 -> check_balance (置信度: 0.800)
2025-07-31 11:15:14,668 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='帮我查余额'
2025-07-31 11:15:14,669 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:15:14,700 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.2 INSERT by slot_service
2025-07-31 11:15:14,724 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=2, 节点数=1, 边数=0
2025-07-31 11:15:14,762 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_004, 继承槽位=0, 应用规则=0
2025-07-31 11:15:14,899 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '帮我查余额...' -> 0 个实体
2025-07-31 11:15:15,077 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:15:15,079 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-31 11:15:15,107 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-31 11:15:15,408 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6859ms [req_id=req_1753931708548]
2025-07-31 11:15:15,408 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6859ms
2025-07-31 11:15:15,410 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='帮我查余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:15:15,426 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-31 11:15:15,440 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=5, 成功=1/1
2025-07-31 11:15:15,441 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 5
2025-07-31 11:15:41,297 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753931741297]
2025-07-31 11:15:41,301 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753931741_a6afdff2, 用户: partial_intent_user_005
2025-07-31 11:15:41,312 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_005
2025-07-31 11:15:41,383 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_a1ea7ffffef9 for user: partial_intent_user_005
2025-07-31 11:15:41,525 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_005, 项目数: 12
2025-07-31 11:15:41,560 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_005, 项目数: 12
2025-07-31 11:15:41,561 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_a1ea7ffffef9
2025-07-31 11:15:41,578 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:15:41,578 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:15:45,858 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 change_password 得分: 1.900, 匹配关键词: ['exact_match:修改密码', 'example_in_input:改密码', 'partial_in_example:我想修改密码']
2025-07-31 11:15:45,858 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: change_password, 最佳得分: 1.900
2025-07-31 11:15:45,863 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: None -> Intent(change_password: 修改密码)
2025-07-31 11:15:45,865 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 修改密码 -> Intent(change_password: 修改密码) (0.800)
2025-07-31 11:15:45,870 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (change_password)阈值 0.700 (等级: medium)
2025-07-31 11:15:45,888 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 修改密码 -> change_password
2025-07-31 11:15:45,892 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 修改密码 -> change_password (置信度: 0.800)
2025-07-31 11:15:45,893 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='修改密码'
2025-07-31 11:15:45,893 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:15:45,910 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.8 INSERT by slot_service
2025-07-31 11:15:45,998 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=8, 节点数=3, 边数=0
2025-07-31 11:15:46,024 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_005, 继承槽位=0, 应用规则=0
2025-07-31 11:15:46,176 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '修改密码...' -> 0 个实体
2025-07-31 11:15:46,389 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:15:46,391 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: change_password, 提取=0个, 继承=0个, 缺失=3个
2025-07-31 11:15:46,533 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5235ms [req_id=req_1753931741297]
2025-07-31 11:15:46,533 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5235ms
2025-07-31 11:15:46,535 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='修改密码', intent='change_password', status='incomplete', response_type='slot_prompt'
2025-07-31 11:15:46,547 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 6
2025-07-31 11:16:12,648 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753931772647]
2025-07-31 11:16:12,652 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753931772_addaf551, 用户: partial_intent_user_006
2025-07-31 11:16:12,662 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_006
2025-07-31 11:16:12,728 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_1e02c199bdd5 for user: partial_intent_user_006
2025-07-31 11:16:12,762 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_006, 项目数: 12
2025-07-31 11:16:12,924 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_006, 项目数: 12
2025-07-31 11:16:12,926 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_1e02c199bdd5
2025-07-31 11:16:12,955 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:16:12,956 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:16:19,867 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 40.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票']
2025-07-31 11:16:19,868 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:16:19,869 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:16:19,869 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 7.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:16:19,870 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 40.000
2025-07-31 11:16:19,874 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_generic: 通用订票) -> Intent(book_flight: 订机票)
2025-07-31 11:16:19,875 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 从北京出发的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-31 11:16:19,879 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-31 11:16:19,988 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 从北京出发的机票 -> book_flight
2025-07-31 11:16:19,993 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 从北京出发的机票 -> book_flight (置信度: 0.800)
2025-07-31 11:16:19,993 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='从北京出发的机票'
2025-07-31 11:16:19,994 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:16:20,031 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_006, 继承槽位=0, 应用规则=0
2025-07-31 11:16:22,909 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '从北京出发的机票...' -> 1 个实体
2025-07-31 11:16:25,363 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'departure_city': {'value': '北京', 'confidence': 0.95, 'source': 'entity', 'original_text': '北京'}}
2025-07-31 11:16:25,365 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=1个, 继承=0个, 缺失=5个
2025-07-31 11:16:25,457 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 12809ms [req_id=req_1753931772647]
2025-07-31 11:16:25,458 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 12809ms
2025-07-31 11:16:25,460 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='从北京出发的机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-31 11:16:25,484 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'departure_city': SlotInfo(name='departure_city', original_text='北京', extracted_value='北京', normalized_value='北京', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='北京', source='entity', is_validated=True, validation_error=None)}
2025-07-31 11:16:25,501 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=7, 成功=1/1
2025-07-31 11:16:25,502 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 7
2025-07-31 11:16:41,978 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753931801977]
2025-07-31 11:16:41,981 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753931801_0406b339, 用户: partial_intent_user_007
2025-07-31 11:16:41,991 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_007
2025-07-31 11:16:42,105 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_bcf19f5b66c6 for user: partial_intent_user_007
2025-07-31 11:16:42,138 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_007, 项目数: 12
2025-07-31 11:16:42,142 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_007, 项目数: 12
2025-07-31 11:16:42,142 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_bcf19f5b66c6
2025-07-31 11:16:42,159 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:16:42,160 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:16:42,256 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: intents.0 INSERT by intent_service
2025-07-31 11:16:48,027 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-31 11:16:48,028 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-31 11:16:48,032 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_flight: 订机票) -> Intent(check_balance: 查询账户余额)
2025-07-31 11:16:48,032 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查招商银行的余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-31 11:16:48,037 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-31 11:16:48,147 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查招商银行的余额 -> check_balance
2025-07-31 11:16:48,151 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查招商银行的余额 -> check_balance (置信度: 0.800)
2025-07-31 11:16:48,151 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查招商银行的余额'
2025-07-31 11:16:48,152 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:16:48,194 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_007, 继承槽位=0, 应用规则=0
2025-07-31 11:16:51,428 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查招商银行的余额...' -> 1 个实体
2025-07-31 11:16:54,380 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'account_type': {'value': '招商银行', 'confidence': 0.95, 'source': 'entity', 'original_text': '查招商银行'}}
2025-07-31 11:16:54,382 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=1个, 继承=0个, 缺失=0个
2025-07-31 11:16:54,405 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 12427ms [req_id=req_1753931801977]
2025-07-31 11:16:54,406 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 12427ms
2025-07-31 11:16:54,410 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查招商银行的余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:16:54,435 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='查招商银行', extracted_value='查招商银行', normalized_value='查招商银行', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='查招商银行', source='entity', is_validated=True, validation_error=None)}
2025-07-31 11:16:54,453 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=8, 成功=1/1
2025-07-31 11:16:54,454 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 8
2025-07-31 11:21:12,978 - src.main - [32mINFO[0m - main.py:72 - 正在关闭系统...
2025-07-31 11:21:12,985 - src.services.cache_service - [32mINFO[0m - cache_service.py:87 - Redis连接已关闭
2025-07-31 11:21:12,987 - src.main - [32mINFO[0m - main.py:88 - 系统关闭完成
2025-07-31 11:24:33,633 - src.main - [32mINFO[0m - main.py:33 - 正在启动智能意图识别系统...
2025-07-31 11:24:33,637 - src.main - [32mINFO[0m - main.py:38 - 数据库连接初始化完成
2025-07-31 11:24:33,852 - src.main - [32mINFO[0m - main.py:42 - 数据表检查完成
2025-07-31 11:24:33,882 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-31 11:24:33,882 - src.main - [32mINFO[0m - main.py:47 - Redis缓存初始化完成
2025-07-31 11:24:33,884 - src.services.startup_service - [32mINFO[0m - startup_service.py:26 - 开始初始化系统服务...
2025-07-31 11:24:33,885 - src.services.startup_service - [32mINFO[0m - startup_service.py:50 - 缓存服务初始化完成
2025-07-31 11:24:33,932 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:115 - 加载同义词词典完成: 47个同义词, 12个词组
2025-07-31 11:24:33,940 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:154 - 加载停用词完成: 52个
2025-07-31 11:24:33,947 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:192 - 加载实体模式完成: 10个
2025-07-31 11:24:33,948 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:51 - 同义词数据重新加载完成
2025-07-31 11:24:33,949 - src.services.synonym_service - [32mINFO[0m - synonym_service.py:35 - 同义词服务初始化完成
2025-07-31 11:24:33,949 - src.services.startup_service - [32mINFO[0m - startup_service.py:58 - ✅ 同义词服务初始化完成
2025-07-31 11:24:33,950 - src.services.startup_service - [32mINFO[0m - startup_service.py:68 - 其他服务初始化完成
2025-07-31 11:24:33,951 - src.services.startup_service - [32mINFO[0m - startup_service.py:38 - ✅ 所有系统服务初始化完成
2025-07-31 11:24:33,952 - src.main - [32mINFO[0m - main.py:51 - 系统服务初始化完成
2025-07-31 11:24:33,953 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:119 - LLM初始化完成 - 连接到: http://10.5.180.13:9997/v1/chat/completions
2025-07-31 11:24:34,266 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:241 - ✅ LLM连接测试成功
2025-07-31 11:24:34,271 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:162 - 加载了8个意图到缓存
2025-07-31 11:24:34,288 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:203 - 从数据库加载了17个关键词映射
2025-07-31 11:24:34,289 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:138 - NLU引擎初始化完成
2025-07-31 11:24:34,371 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: intents.0 INSERT by intent_service
2025-07-31 11:24:34,372 - src.main - [32mINFO[0m - main.py:207 - 预热了 8 个活跃意图配置
2025-07-31 11:24:34,383 - src.main - [32mINFO[0m - main.py:214 - 预热了 6 个系统配置
2025-07-31 11:24:34,384 - src.main - [32mINFO[0m - main.py:55 - 缓存预热完成
2025-07-31 11:24:34,385 - src.main - [32mINFO[0m - main.py:60 - NLU引擎初始化完成
2025-07-31 11:24:34,386 - src.main - [32mINFO[0m - main.py:62 - 🚀 系统启动完成！监听端口: http://localhost:8000
2025-07-31 11:24:34,386 - src.main - [32mINFO[0m - main.py:63 - 📚 API文档: http://localhost:8000/docs
2025-07-31 11:24:52,592 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932292592]
2025-07-31 11:24:52,816 - src.services.cache_service - [32mINFO[0m - cache_service.py:73 - Redis缓存服务初始化成功
2025-07-31 11:24:52,822 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932292_d3a37b3a, 用户: partial_intent_user_001
2025-07-31 11:24:52,846 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_001
2025-07-31 11:24:52,910 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_600af5a16043 for user: partial_intent_user_001
2025-07-31 11:24:52,957 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_001, 项目数: 12
2025-07-31 11:24:53,011 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_001, 项目数: 12
2025-07-31 11:24:53,012 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_600af5a16043
2025-07-31 11:24:53,041 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:24:53,042 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:24:58,349 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 55.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'exact_match:我想订机票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:24:58,350 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:24:58,351 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 30.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:24:58,352 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_match:订']
2025-07-31 11:24:58,352 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 55.000
2025-07-31 11:24:58,358 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_train: 火车票预订) -> Intent(book_flight: 订机票)
2025-07-31 11:24:58,359 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我想订机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-31 11:24:58,364 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-31 11:24:58,438 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我想订机票 -> book_flight
2025-07-31 11:24:58,443 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我想订机票 -> book_flight (置信度: 0.800)
2025-07-31 11:24:58,445 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我想订机票'
2025-07-31 11:24:58,447 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:24:58,471 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.1 INSERT by slot_service
2025-07-31 11:24:58,502 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=1, 节点数=6, 边数=1
2025-07-31 11:24:58,540 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_001, 继承槽位=0, 应用规则=0
2025-07-31 11:24:58,883 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我想订机票...' -> 0 个实体
2025-07-31 11:24:59,103 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:24:59,106 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-31 11:24:59,160 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6567ms [req_id=req_1753932292592]
2025-07-31 11:24:59,160 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6567ms
2025-07-31 11:24:59,164 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我想订机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-31 11:24:59,180 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 1
2025-07-31 11:25:10,017 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932310017]
2025-07-31 11:25:10,021 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932310_1672c8a5, 用户: partial_intent_user_002
2025-07-31 11:25:10,034 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_002
2025-07-31 11:25:10,113 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_eb0c019f0c59 for user: partial_intent_user_002
2025-07-31 11:25:10,152 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_002, 项目数: 12
2025-07-31 11:25:10,216 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_002, 项目数: 12
2025-07-31 11:25:10,218 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_eb0c019f0c59
2025-07-31 11:25:10,247 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:25:10,248 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:25:16,144 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 40.000, 匹配关键词: ['direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票', 'direct_core_match:机票', 'direct_core_match:票']
2025-07-31 11:25:16,146 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:25:16,147 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 10.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:25:16,148 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 7.000, 匹配关键词: ['direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票', 'direct_core_mismatch:机票', 'direct_core_match:票']
2025-07-31 11:25:16,149 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 40.000
2025-07-31 11:25:16,154 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(check_balance: 查询账户余额) -> Intent(book_flight: 订机票)
2025-07-31 11:25:16,154 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我要去上海的机票 -> Intent(book_flight: 订机票) (0.800)
2025-07-31 11:25:16,159 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: medium)
2025-07-31 11:25:16,258 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我要去上海的机票 -> book_flight
2025-07-31 11:25:16,264 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我要去上海的机票 -> book_flight (置信度: 0.800)
2025-07-31 11:25:16,265 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我要去上海的机票'
2025-07-31 11:25:16,266 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:25:16,359 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_002, 继承槽位=0, 应用规则=0
2025-07-31 11:25:21,953 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我要去上海的机票...' -> 1 个实体
2025-07-31 11:25:24,351 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {'arrival_city': {'value': '上海', 'confidence': 0.95, 'source': 'entity', 'original_text': '上海'}}
2025-07-31 11:25:24,353 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=1个, 继承=0个, 缺失=5个
2025-07-31 11:25:24,474 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 14456ms [req_id=req_1753932310017]
2025-07-31 11:25:24,474 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 14456ms
2025-07-31 11:25:24,477 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我要去上海的机票', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-31 11:25:24,496 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'arrival_city': SlotInfo(name='arrival_city', original_text='上海', extracted_value='上海', normalized_value='上海', confidence=0.95, extraction_method='entity', validation=None, is_confirmed=True, value='上海', source='entity', is_validated=True, validation_error=None)}
2025-07-31 11:25:24,512 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=2, 成功=1/1
2025-07-31 11:25:24,513 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 2
2025-07-31 11:25:28,061 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932328060]
2025-07-31 11:25:28,066 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932328_14995dc2, 用户: partial_intent_user_004
2025-07-31 11:25:28,076 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_004
2025-07-31 11:25:28,149 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_bedf87a1d64e for user: partial_intent_user_004
2025-07-31 11:25:28,288 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_004, 项目数: 12
2025-07-31 11:25:28,348 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_004, 项目数: 12
2025-07-31 11:25:28,350 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_bedf87a1d64e
2025-07-31 11:25:28,378 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:25:28,379 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:25:34,253 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-31 11:25:34,255 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-31 11:25:34,258 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_flight: 订机票) -> Intent(check_balance: 查询账户余额)
2025-07-31 11:25:34,259 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 帮我查余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-31 11:25:34,263 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-31 11:25:34,278 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 帮我查余额 -> check_balance
2025-07-31 11:25:34,282 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 帮我查余额 -> check_balance (置信度: 0.800)
2025-07-31 11:25:34,283 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='帮我查余额'
2025-07-31 11:25:34,285 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:25:34,306 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.2 INSERT by slot_service
2025-07-31 11:25:34,391 - src.core.dependency_graph - [32mINFO[0m - dependency_graph.py:478 - 构建依赖图完成: intent_id=2, 节点数=1, 边数=0
2025-07-31 11:25:34,430 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_004, 继承槽位=0, 应用规则=0
2025-07-31 11:25:34,609 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '帮我查余额...' -> 0 个实体
2025-07-31 11:25:34,823 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:25:34,826 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-31 11:25:34,909 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-31 11:25:35,094 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 7033ms [req_id=req_1753932328060]
2025-07-31 11:25:35,094 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 7033ms
2025-07-31 11:25:35,096 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='帮我查余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:25:35,112 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-31 11:25:35,126 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=3, 成功=1/1
2025-07-31 11:25:35,127 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 3
2025-07-31 11:26:01,570 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932361570]
2025-07-31 11:26:01,574 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932361_a268124a, 用户: partial_intent_user_007
2025-07-31 11:26:01,584 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: partial_intent_user_007
2025-07-31 11:26:01,648 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_83e4cba6ad61 for user: partial_intent_user_007
2025-07-31 11:26:01,694 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: partial_intent_user_007, 项目数: 12
2025-07-31 11:26:01,721 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: partial_intent_user_007, 项目数: 12
2025-07-31 11:26:01,722 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_83e4cba6ad61
2025-07-31 11:26:01,740 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:26:01,740 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:26:08,059 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 40.000, 匹配关键词: ['direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查', 'direct_core_match:余额', 'direct_core_match:查']
2025-07-31 11:26:08,061 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 40.000
2025-07-31 11:26:08,065 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_train: 火车票预订) -> Intent(check_balance: 查询账户余额)
2025-07-31 11:26:08,066 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 查招商银行的余额 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-31 11:26:08,071 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-31 11:26:08,172 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 查招商银行的余额 -> check_balance
2025-07-31 11:26:08,177 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 查招商银行的余额 -> check_balance (置信度: 0.800)
2025-07-31 11:26:08,178 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='查招商银行的余额'
2025-07-31 11:26:08,179 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:26:08,224 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=partial_intent_user_007, 继承槽位=0, 应用规则=0
2025-07-31 11:26:11,443 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '查招商银行的余额...' -> 1 个实体
2025-07-31 11:26:11,638 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:26:11,640 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-31 11:26:11,688 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-31 11:26:11,691 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 10121ms [req_id=req_1753932361570]
2025-07-31 11:26:11,692 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 10121ms
2025-07-31 11:26:11,695 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='查招商银行的余额', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:26:11,717 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-31 11:26:11,735 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=4, 成功=1/1
2025-07-31 11:26:11,735 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 4
2025-07-31 11:27:07,238 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932427238]
2025-07-31 11:27:07,243 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932427_de889170, 用户: low_confidence_user_001
2025-07-31 11:27:07,253 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_001
2025-07-31 11:27:07,360 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_f08750ad3c5b for user: low_confidence_user_001
2025-07-31 11:27:07,409 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_001, 项目数: 12
2025-07-31 11:27:07,463 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_001, 项目数: 12
2025-07-31 11:27:07,464 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_f08750ad3c5b
2025-07-31 11:27:07,484 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:27:07,485 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:27:13,344 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我想出行 -> Intent(book_movie: 电影票预订) (0.620)
2025-07-31 11:27:13,359 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (book_flight)阈值 0.400 (等级: high)
2025-07-31 11:27:13,378 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.825, 主要类型=semantic, 信号数=14
2025-07-31 11:27:13,379 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.825, 主要类型=semantic, 候选数=1
2025-07-31 11:27:13,406 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我想出行 -> book_flight
2025-07-31 11:27:13,411 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我想出行 -> book_flight (置信度: 0.800)
2025-07-31 11:27:13,412 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我想出行'
2025-07-31 11:27:13,413 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:27:13,484 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=low_confidence_user_001, 继承槽位=0, 应用规则=0
2025-07-31 11:27:13,702 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我想出行...' -> 0 个实体
2025-07-31 11:27:13,920 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:27:13,923 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: book_flight, 提取=0个, 继承=0个, 缺失=6个
2025-07-31 11:27:13,960 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6721ms [req_id=req_1753932427238]
2025-07-31 11:27:13,961 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6721ms
2025-07-31 11:27:13,963 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我想出行', intent='book_flight', status='incomplete', response_type='slot_prompt'
2025-07-31 11:27:13,974 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 5
2025-07-31 11:27:42,680 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932462680]
2025-07-31 11:27:42,684 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932462_2b691fcc, 用户: low_confidence_user_002
2025-07-31 11:27:42,695 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_002
2025-07-31 11:27:42,809 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_f2c6384ba69b for user: low_confidence_user_002
2025-07-31 11:27:43,058 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_002, 项目数: 12
2025-07-31 11:27:43,105 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_002, 项目数: 12
2025-07-31 11:27:43,106 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_f2c6384ba69b
2025-07-31 11:27:43,131 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:27:43,132 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:27:48,850 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 20.000, 匹配关键词: ['direct_core_match:钱', 'direct_core_match:钱', 'direct_core_match:钱', 'direct_core_match:钱', 'direct_core_match:钱', 'direct_core_match:钱', 'direct_core_match:钱', 'direct_core_match:钱', 'direct_core_match:钱', 'direct_core_match:钱']
2025-07-31 11:27:48,852 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 20.000
2025-07-31 11:27:48,857 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(change_password: 修改密码) -> Intent(check_balance: 查询账户余额)
2025-07-31 11:27:48,858 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我要用钱 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-31 11:27:48,862 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-31 11:27:48,934 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我要用钱 -> check_balance
2025-07-31 11:27:48,939 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我要用钱 -> check_balance (置信度: 0.800)
2025-07-31 11:27:48,940 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我要用钱'
2025-07-31 11:27:48,941 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:27:48,989 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=low_confidence_user_002, 继承槽位=0, 应用规则=0
2025-07-31 11:27:49,148 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我要用钱...' -> 0 个实体
2025-07-31 11:27:49,362 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:27:49,364 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-31 11:27:49,461 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-31 11:27:49,466 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6785ms [req_id=req_1753932462680]
2025-07-31 11:27:49,467 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6785ms
2025-07-31 11:27:49,471 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我要用钱', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:27:49,497 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-31 11:27:49,513 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=6, 成功=1/1
2025-07-31 11:27:49,514 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 6
2025-07-31 11:28:04,650 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932484650]
2025-07-31 11:28:04,655 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932484_3602db15, 用户: low_confidence_user_003
2025-07-31 11:28:04,665 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_003
2025-07-31 11:28:04,704 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_d910bc3a344a for user: low_confidence_user_003
2025-07-31 11:28:04,741 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_003, 项目数: 12
2025-07-31 11:28:04,814 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_003, 项目数: 12
2025-07-31 11:28:04,815 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_d910bc3a344a
2025-07-31 11:28:04,844 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:28:04,845 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:28:10,658 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 20.000, 匹配关键词: ['direct_core_match:账户', 'direct_core_match:账户', 'direct_core_match:账户', 'direct_core_match:账户', 'direct_core_match:账户', 'direct_core_match:账户', 'direct_core_match:账户', 'direct_core_match:账户', 'direct_core_match:账户', 'direct_core_match:账户']
2025-07-31 11:28:10,660 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 20.000
2025-07-31 11:28:10,665 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_generic: 通用订票) -> Intent(check_balance: 查询账户余额)
2025-07-31 11:28:10,666 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 账户操作 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-31 11:28:10,670 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-31 11:28:10,746 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 账户操作 -> check_balance
2025-07-31 11:28:10,751 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 账户操作 -> check_balance (置信度: 0.800)
2025-07-31 11:28:10,752 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='账户操作'
2025-07-31 11:28:10,753 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:28:10,797 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=low_confidence_user_003, 继承槽位=0, 应用规则=0
2025-07-31 11:28:11,033 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '账户操作...' -> 0 个实体
2025-07-31 11:28:11,247 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:28:11,249 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-31 11:28:11,268 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-31 11:28:11,272 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6621ms [req_id=req_1753932484650]
2025-07-31 11:28:11,273 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6621ms
2025-07-31 11:28:11,276 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='账户操作', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:28:11,300 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-31 11:28:11,316 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=7, 成功=1/1
2025-07-31 11:28:11,317 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 7
2025-07-31 11:28:23,807 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932503807]
2025-07-31 11:28:23,811 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932503_a6c6f263, 用户: low_confidence_user_004
2025-07-31 11:28:23,821 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_004
2025-07-31 11:28:23,840 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_f376f232b7fe for user: low_confidence_user_004
2025-07-31 11:28:23,885 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_004, 项目数: 12
2025-07-31 11:28:23,942 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_004, 项目数: 12
2025-07-31 11:28:23,943 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_f376f232b7fe
2025-07-31 11:28:23,961 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:28:23,962 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:28:30,008 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_flight 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-31 11:28:30,009 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_train 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-31 11:28:30,010 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_movie 得分: 40.000, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买']
2025-07-31 11:28:30,011 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 book_generic 得分: 21.600, 匹配关键词: ['direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'direct_core_match:票', 'direct_core_match:买', 'example_in_input:买票', 'exact_match:我想买票']
2025-07-31 11:28:30,012 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: book_flight, 最佳得分: 40.000
2025-07-31 11:28:30,016 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我想买票 -> Intent(book_flight: 订机票) (0.865)
2025-07-31 11:28:30,035 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.865 通过 intent-specific (book_flight)阈值 0.400 (等级: high) | 检测到歧义 (差值: 0.065, 阈值: 0.100)
2025-07-31 11:28:30,059 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.814, 主要类型=semantic, 信号数=15
2025-07-31 11:28:30,060 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.814, 主要类型=semantic, 候选数=2
2025-07-31 11:28:30,072 - src.services.intent_service - [32mINFO[0m - intent_service.py:539 - 增强歧义检测确认: 2个候选意图, 歧义得分=0.814, 主要类型=semantic
2025-07-31 11:28:30,073 - src.core.multi_strategy_resolver - [32mINFO[0m - multi_strategy_resolver.py:173 - 尝试策略: interactive
2025-07-31 11:28:30,075 - src.core.multi_strategy_resolver - [32mINFO[0m - multi_strategy_resolver.py:199 - 策略interactive失败: 需要用户交互确认
2025-07-31 11:28:30,078 - src.services.intent_service - [32mINFO[0m - intent_service.py:1217 - 自动解决尝试: 策略=escalation, 结果=failed, 置信度=0.000
2025-07-31 11:28:30,187 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我想买票 -> None
2025-07-31 11:28:30,195 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我想买票 -> None (置信度: 0.865)
2025-07-31 11:28:30,217 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:433 - 记录意图歧义: session=sess_f376f232b7fe, candidates_count=2
2025-07-31 11:28:30,219 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6411ms [req_id=req_1753932503807]
2025-07-31 11:28:30,220 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6411ms
2025-07-31 11:28:30,224 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我想买票', intent='None', status='ambiguous', response_type='disambiguation'
2025-07-31 11:28:30,239 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 9
2025-07-31 11:28:42,623 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932522623]
2025-07-31 11:28:42,627 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932522_7a4e3c9b, 用户: low_confidence_user_005
2025-07-31 11:28:42,638 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_005
2025-07-31 11:28:42,685 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_0f3262ed088c for user: low_confidence_user_005
2025-07-31 11:28:42,724 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_005, 项目数: 12
2025-07-31 11:28:42,785 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_005, 项目数: 12
2025-07-31 11:28:42,787 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_0f3262ed088c
2025-07-31 11:28:42,811 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:28:42,812 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:28:48,203 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:633 - 规则匹配 - 意图 check_balance 得分: 20.000, 匹配关键词: ['direct_core_match:查', 'direct_core_match:查', 'direct_core_match:查', 'direct_core_match:查', 'direct_core_match:查', 'direct_core_match:查', 'direct_core_match:查', 'direct_core_match:查', 'direct_core_match:查', 'direct_core_match:查']
2025-07-31 11:28:48,204 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:648 - 规则匹配最终结果 - 最佳意图: check_balance, 最佳得分: 20.000
2025-07-31 11:28:48,209 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:306 - 规则匹配置信度高(0.950)，覆盖LLM结果: Intent(book_movie: 电影票预订) -> Intent(check_balance: 查询账户余额)
2025-07-31 11:28:48,210 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我想查一下 -> Intent(check_balance: 查询账户余额) (0.800)
2025-07-31 11:28:48,214 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.800 通过 intent-specific (check_balance)阈值 0.700 (等级: medium)
2025-07-31 11:28:48,306 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我想查一下 -> check_balance
2025-07-31 11:28:48,310 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我想查一下 -> check_balance (置信度: 0.800)
2025-07-31 11:28:48,310 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我想查一下'
2025-07-31 11:28:48,311 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:28:48,351 - src.core.slot_inheritance - [32mINFO[0m - slot_inheritance.py:572 - 完成继承处理: 用户=low_confidence_user_005, 继承槽位=0, 应用规则=0
2025-07-31 11:28:48,526 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:719 - 实体提取完成: '我想查一下...' -> 1 个实体
2025-07-31 11:28:48,736 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:1451 - LLM槽位提取结果: {}
2025-07-31 11:28:48,737 - src.services.slot_service - [32mINFO[0m - slot_service.py:153 - 增强槽位提取完成: check_balance, 提取=0个, 继承=0个, 缺失=1个
2025-07-31 11:28:48,937 - src.api.v1.chat - [32mINFO[0m - chat.py:1301 - 为槽位 account_type 应用默认值: 银行卡
2025-07-31 11:28:48,940 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6316ms [req_id=req_1753932522623]
2025-07-31 11:28:48,941 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6316ms
2025-07-31 11:28:48,943 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我想查一下', intent='check_balance', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:28:48,968 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:692 - 准备保存槽位值: {'account_type': SlotInfo(name='account_type', original_text='银行卡', extracted_value='银行卡', normalized_value='银行卡', confidence=1.0, extraction_method='default', validation=None, is_confirmed=True, value='银行卡', source='default', is_validated=True, validation_error=None)}
2025-07-31 11:28:48,989 - src.services.slot_value_service - [32mINFO[0m - slot_value_service.py:740 - 保存对话槽位完成: conversation_id=10, 成功=1/1
2025-07-31 11:28:48,989 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 10
2025-07-31 11:29:01,421 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932541421]
2025-07-31 11:29:01,426 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932541_066a4d54, 用户: low_confidence_user_006
2025-07-31 11:29:01,440 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_006
2025-07-31 11:29:01,515 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_ae0c9b53ef40 for user: low_confidence_user_006
2025-07-31 11:29:01,557 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_006, 项目数: 12
2025-07-31 11:29:01,618 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_006, 项目数: 12
2025-07-31 11:29:01,620 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_ae0c9b53ef40
2025-07-31 11:29:01,651 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:29:01,652 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:29:07,497 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 帮我办理业务 -> Intent(change_password: 修改密码) (0.469)
2025-07-31 11:29:07,509 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.650 通过 intent-specific (book_generic)阈值 0.300 (等级: medium)
2025-07-31 11:29:07,524 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.822, 主要类型=semantic, 信号数=8
2025-07-31 11:29:07,526 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.822, 主要类型=semantic, 候选数=1
2025-07-31 11:29:07,557 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 帮我办理业务 -> book_generic
2025-07-31 11:29:07,562 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 帮我办理业务 -> book_generic (置信度: 0.650)
2025-07-31 11:29:07,563 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='帮我办理业务'
2025-07-31 11:29:07,564 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:29:07,580 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.5 INSERT by slot_service
2025-07-31 11:29:07,686 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6264ms [req_id=req_1753932541421]
2025-07-31 11:29:07,687 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6264ms
2025-07-31 11:29:07,690 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='帮我办理业务', intent='book_generic', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:29:07,706 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 11
2025-07-31 11:29:22,746 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932562746]
2025-07-31 11:29:22,750 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932562_fd3ed4dc, 用户: low_confidence_user_007
2025-07-31 11:29:22,761 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_007
2025-07-31 11:29:22,768 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_056f0d0d6d12 for user: low_confidence_user_007
2025-07-31 11:29:22,810 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_007, 项目数: 12
2025-07-31 11:29:22,815 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_007, 项目数: 12
2025-07-31 11:29:22,815 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_056f0d0d6d12
2025-07-31 11:29:22,836 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:29:22,836 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:29:28,072 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我需要去外地 -> Intent(book_flight: 订机票) (0.348)
2025-07-31 11:29:28,090 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.400 通过 intent-specific (book_generic)阈值 0.300 (等级: low) | 检测到歧义 (差值: 0.052, 阈值: 0.100)
2025-07-31 11:29:28,114 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.818, 主要类型=semantic, 信号数=16
2025-07-31 11:29:28,114 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.818, 主要类型=semantic, 候选数=0
2025-07-31 11:29:28,135 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我需要去外地 -> book_generic
2025-07-31 11:29:28,140 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我需要去外地 -> book_generic (置信度: 0.400)
2025-07-31 11:29:28,142 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我需要去外地'
2025-07-31 11:29:28,143 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:29:28,247 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.5 INSERT by slot_service
2025-07-31 11:29:28,354 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 5608ms [req_id=req_1753932562746]
2025-07-31 11:29:28,355 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 5608ms
2025-07-31 11:29:28,359 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我需要去外地', intent='book_generic', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:29:28,376 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 12
2025-07-31 11:29:48,387 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932588387]
2025-07-31 11:29:48,392 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932588_506e7199, 用户: low_confidence_user_008
2025-07-31 11:29:48,403 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_008
2025-07-31 11:29:48,513 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_1131cee136f4 for user: low_confidence_user_008
2025-07-31 11:29:48,551 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_008, 项目数: 12
2025-07-31 11:29:48,615 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_008, 项目数: 12
2025-07-31 11:29:48,616 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_1131cee136f4
2025-07-31 11:29:48,637 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:29:48,638 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:29:54,264 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 我想更新一些信息 -> Intent(change_password: 修改密码) (0.469)
2025-07-31 11:29:54,278 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.650 通过 intent-specific (book_generic)阈值 0.300 (等级: medium)
2025-07-31 11:29:54,294 - src.core.ambiguity_detector - [32mINFO[0m - ambiguity_detector.py:154 - 歧义检测完成: 综合得分=0.822, 主要类型=semantic, 信号数=8
2025-07-31 11:29:54,294 - src.services.intent_service - [32mINFO[0m - intent_service.py:1082 - 增强歧义检测: 歧义得分=0.822, 主要类型=semantic, 候选数=1
2025-07-31 11:29:54,349 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 我想更新一些信息 -> book_generic
2025-07-31 11:29:54,353 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 我想更新一些信息 -> book_generic (置信度: 0.650)
2025-07-31 11:29:54,355 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='我想更新一些信息'
2025-07-31 11:29:54,356 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:29:54,376 - src.services.audit_service - [32mINFO[0m - audit_service.py:77 - 记录审计日志成功: slot_definitions.5 INSERT by slot_service
2025-07-31 11:29:54,415 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6027ms [req_id=req_1753932588387]
2025-07-31 11:29:54,415 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6027ms
2025-07-31 11:29:54,419 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='我想更新一些信息', intent='book_generic', status='awaiting_confirmation', response_type='confirmation_prompt'
2025-07-31 11:29:54,431 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 13
2025-07-31 11:31:13,286 - request - [32mINFO[0m - logger.py:131 - REQUEST POST http://localhost:8000/api/v1/chat/interact [req_id=req_1753932673286]
2025-07-31 11:31:13,291 - src.api.v1.chat - [32mINFO[0m - chat.py:72 - 收到对话请求: req_1753932673_47b506f0, 用户: low_confidence_user_009
2025-07-31 11:31:13,302 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:180 - 创建新用户: low_confidence_user_009
2025-07-31 11:31:13,363 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:202 - 创建新会话: sess_b4e16f0235c5 for user: low_confidence_user_009
2025-07-31 11:31:13,435 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:251 - 保存默认用户偏好: low_confidence_user_009, 项目数: 12
2025-07-31 11:31:13,438 - src.services.user_preference_service - [32mINFO[0m - user_preference_service.py:78 - 获取用户偏好成功: low_confidence_user_009, 项目数: 12
2025-07-31 11:31:13,439 - src.services.conversation_service - [32mINFO[0m - conversation_service.py:294 - 直接从数据库获取对话历史: sess_b4e16f0235c5
2025-07-31 11:31:13,457 - src.api.v1.chat - [32mINFO[0m - chat.py:949 - 槽位补充检查: 获取到对话历史0轮
2025-07-31 11:31:13,458 - src.api.v1.chat - [32mINFO[0m - chat.py:952 - 槽位补充检查: 无对话历史，跳过
2025-07-31 11:31:20,113 - src.core.nlu_engine - [32mINFO[0m - nlu_engine.py:342 - 意图识别完成: 入职流程 -> Intent(book_movie: 电影票预订) (0.106)
2025-07-31 11:31:20,128 - src.services.intent_service - [32mINFO[0m - intent_service.py:456 - 阈值决策: 置信度 0.106 未通过 intent-specific (book_movie)阈值 0.400 (等级: reject) | 检测到歧义 (差值: 0.056, 阈值: 0.100)
2025-07-31 11:31:20,132 - src.services.intent_service - [32mINFO[0m - intent_service.py:106 - 意图识别完成: 入职流程 -> None
2025-07-31 11:31:20,136 - src.services.intent_service - [32mINFO[0m - intent_service.py:193 - 历史增强意图识别完成: 入职流程 -> None (置信度: 0.106)
2025-07-31 11:31:20,137 - src.api.v1.chat - [32mINFO[0m - chat.py:822 - 检查确认响应: 用户输入='入职流程'
2025-07-31 11:31:20,138 - src.api.v1.chat - [32mINFO[0m - chat.py:828 - 确认检查: 无对话历史，跳过
2025-07-31 11:31:20,140 - src.api.v1.chat - [32mINFO[0m - chat.py:329 - 跳过RAGFLOW调用，使用降级处理
2025-07-31 11:31:20,145 - request - [32mINFO[0m - logger.py:137 - RESPONSE 200 6858ms [req_id=req_1753932673286]
2025-07-31 11:31:20,147 - performance - [32mINFO[0m - logger.py:167 - API_CALL POST /api/v1/chat/interact SUCCESS 6858ms
2025-07-31 11:31:20,150 - src.api.v1.chat - [32mINFO[0m - chat.py:745 - 保存对话记录: user_input='入职流程', intent='None', status='non_intent_input', response_type='qa_response'
2025-07-31 11:31:20,167 - src.api.v1.chat - [32mINFO[0m - chat.py:797 - 对话记录保存成功: 14
